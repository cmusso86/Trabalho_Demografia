---
titulo: "Estrutura da População e Projeções"
subtitulo: "Santa Catarina"
aluno1:  "Carolina Musso 18/0047850"
aluno2: "Jéssica Vasconcelos 18/0048708"
aluno3: "Laura Teixeira 19/0016051"
aluno4: "Leonardo dos Reis Andrade 21/1029030"
orientador: "Ana Maria Nogales"
ano: "1/2023"
referencias: referencias.bib
output: 
  bookdown::pdf_document2:
    template: template.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)
```

```{r bibliotecas}
# Carregando bibliotecas ---------

pacman::p_load(foreign,tidyverse, LexisPlotR, readxl, janitor, kableExtra, 
               scales, reshape2, cowplot, ggmosaic, gplots, corrplot,
               DescTools,RColorBrewer, rio, apyramid, magrittr,
               patchwork)

pacman::p_load_gh("danicat/read.dbc")

```

```{r bases}
# BASES ----

pop_censos <- import("Bases/populacao_91_00_10.xlsx")
pop_proj <- import("Bases/populacao_15_20_30.xlsx")
```

# Introdução

O estado brasileiro de Santa Catarina tem como capital a ilha de Floranópolis e está localizado no centro da região sul do país. O estado faz fronteira ao norte com o Paraná e ao sul pelo Rio Grande do Sul. É banhado ao leste pelo Oceano Atlântico e e ao oeste faz fronteira com a Argentina. Sua área abrange 95.736,165 km² e possui uma população de mais de 6 milhões de habitantes, sendo o décimo estado mais populoso do Brasil. O estado possui 295 municípios, sendo Joinville, Florianópolis, Blumenau, Criciúma e Chapecó as principais cidades \cite{IBGE}.

Santa Catarina possui índices sociais muito elevados em comparação com o restante do Brasil. É o estado com a maior expectativa de vida, empatando com o Distrito Federal. Além disso, possui a menor taxa de mortalidade infantil e é o estado com menor desigualdade econômica e analfabetismo no país. Em termos econômicos, Santa Catarina possui o sexto maior Produto Interno Bruto (PIB) do Brasil e o quarto maior PIB per capita, ficando atrás apenas do Distrito Federal, São Paulo e Mato Grosso. Sua economia é diversificada e tem uma forte ênfase na industrialização. O estado é um importante polo de exportação e consumo, sendo um dos maiores contribuintes para o crescimento da economia brasileira, representando 4% do PIB nacional \cite{IBGE2}. 

Santa Catarina também enfrenta um processo de envelhecimento da população, um fenômeno observado no Brasil e em muitos países ao redor do mundo. A proporção de idosos vem aumentando significativamente nas últimas décadas, devido a fatores como avanços na área da saúde, melhorias nas condições de vida e diminuição da taxa de natalidade.

Esse envelhecimento populacional tem impactos em diversos aspectos da sociedade catarinense. O aumento da expectativa de vida e a diminuição da taxa de natalidade resultam em um crescimento relativo da população idosa em comparação com a população jovem. Isso traz desafios e oportunidades para o estado, incluindo questões relacionadas à saúde, previdência, políticas públicas e inclusão social.

O tema desse trabalho é o estudo da dinâmica e estrutura demográfica do estado de Santa Catarina por meio de pirâmides etárias, indicadores relacionados e a projeção de sua população.


# Desenvolvimento

## Parte 1 - Estrutura Populacional e avaliação da informação sobre idade

**a) Construa as pirâmides etárias por grupos de idade para a população da UF escolhida em 1991, 2000, 2010, 2015, 2020 e 2030 (obtenha os dados no portal do Datasus para os anos censitários e projeções para os demais anos). Comente os resultados à luz da discussão sobre transição demográfica.**

```{r}
fx1 <- c("Menor 1 ano", "1 ano", "2 anos", "3 anos", "4 anos")
fx2 <- c( "5 anos", "6 anos", "7 anos", "8 anos", "9 anos")
fx3 <- c( "10 anos", "11 anos", "12 anos", "13 anos", "14 anos")
fx4 <- c( "15 anos", "16 anos", "17 anos", "18 anos", "19 anos")

pop_censo_trat <- pop_censos %>% 
  mutate(faixa=case_when(Idade %in% fx1 ~ "0-4",
                   Idade %in% fx2 ~ "5-9",
                   Idade %in% fx3 ~ "10-14",
                   Idade %in% fx4 ~ "15-19",
                   .default = Idade)) %>% 
  pivot_longer(-c(Idade, faixa, sexo), names_to = "Ano", 
               values_to = "Pop") %>% 
  mutate(faixa=str_replace(faixa, " a ", "-"),
         faixa=str_replace(faixa, " anos", ""),
         faixa=str_replace(faixa, "80 e mais", "80-"))%>% 
  select(-Idade) 

pop_proj_trat <- pop_proj %>% 
  mutate(faixa=cut(idade, breaks = c(-1, 5, 10, 15, 20, 25, 30, 35, 40, 
                                     45, 50, 55, 60, 65, 70, 75, 80, 1000 ), 
                   labels = c("0-4","5-9","10-14","15-19","20-24" ,"25-29"
                              ,"30-34","35-39","40-44" ,"45-49" ,"50-54"
                              ,"55-59","60-64" ,"65-69" ,"70-74",
                              "75-79" ,"80-"), include.lowest = T, 
                   right = F)) %>% 
 # select(-idade) %>% 
pivot_longer(-c(faixa, sexo, idade), names_to = "Ano", values_to = "Pop") 


pop_completo <-pop_censo_trat  %>% 
  full_join(pop_proj_trat) %>% 
  mutate(faixa=factor(faixa,levels=c("0-4","5-9","10-14","15-19","20-24" ,
                                     "25-29" ,"30-34","35-39","40-44" ,
                                     "45-49" ,"50-54" ,"55-59","60-64" ,
                                     "65-69" ,"70-74","75-79" ,"80-"))) %>% 
  group_by(Ano,faixa, sexo) %>% 
  summarize(Pop=sum(Pop)) %>% 
  mutate(sexo=factor(sexo, levels=c("m", "f")))
  
```

```{r }

piramides <- list()


for (i in c("1991", "2000", "2010", "2015", "2020", "2030")){
  
 filtro <-pop_completo %>% 
  filter(Ano==i) %>% 
  mutate(pop=Pop/1000) 
#  
xlabels <- as.character(sort(unique(filtro$faixa)))
xlabels[seq(2, length(xlabels), 2)] <- ""
 piramides[[i]]<-  filtro %>% 
apyramid::age_pyramid(age_group = "faixa",
                      split_by = "sexo",
                      count = "pop",
                      show_midpoint = FALSE) +
 # scale_fill_manual("Sexo", values=c( "#003366", "#00822E"))+
  theme_classic(base_size = 9)+
 scale_x_discrete(labels = xlabels)+
theme(legend.position = "none", 
     axis.text.x =element_text(angle = 45, hjust=1))+
  labs(y="mil", x="")+
  ggtitle(i)
}

graf1 <- (piramides[[1]] + piramides[[2]]  )/
  (piramides[[3]] + piramides[[4]]  )/(piramides[[5]] + piramides[[6]]  )

ggsave(graf1, filename="img/Graf1.png")
```

\begin{figure}[H]
    \centering
    \caption{Pirâmides etárias para os anos analisados. Cor verde representa o sexo masculino}
    \includegraphics{img/Graf1.png}
    \small\textsuperscript{Elaboração Própria. Fonte dos Dados: Minstério da saúde} 
    \label{fig:piramides1}
\end{figure}


Com o avanço das fases da transição demográfica (diminuição tanto da mortalidade quando natalidade) a pirâmide vai mudando de forma.  Nota-se que a partir dos anos 2000 (Figura \ref{fig:piramides1}). a base da pirâmide começa a estreitar, indicando uma diminuição nas taxas de natalidade. Conjuntamente,  o topo da pirâmide se alarga, com o envelhecimento da população devido à diminuição da mortalidade. Nota-se que principalmente nos anos de 2015 e 2020, as faixas etárias correspondendo à populaçào economicamente ativa são mais proeminentes, evidenciando o bônus demográfico nesse período, e diminuição da razão de dependência.


**b) Para todos os anos acima mencionados, calcule os indicadores de estrutura por idade (proporção de idosos (60 anos e mais), proporção de crianças (0 a 4 anos), proporção de jovens (0 a 14 anos), razão de dependência e índice de envelhecimento). Calcule a idade média e a idade mediana. Calcule e grafique a razão de sexo por grupos de idade para 2000, 2010 e 2030. Comente os resultados.**

Podemos observar na Tabela \@ref(tab:proporcoes)   como a proporção de jovens diminui a cada ano, atingindo valores de 18% enquanto a porporção de idosos aumenta, até aingir 20% em 2030. Com o aumento a população ativa, a razão de dependence diminui de 2000 até 2015, e volta a aumentar a partir de 2020, com o evelecimento da população, e passa-se a ter mais idosos do que jovens a partir de 2030.

```{r}

idoso <- c("60-64", "65-69", "70-74", "75-79", "80-")

idosos <- pop_completo %>% 
  group_by(Ano, faixa) %>% 
  summarise(Pop=sum(Pop)) %>% 
  mutate(idosos=ifelse(faixa %in% idoso, 1, 0)) %>% 
  group_by(Ano) %>% 
  mutate(pop_tot=sum(Pop))%>% 
  ungroup() %>% 
  group_by(Ano, idosos) %>% 
  summarise(pop_tot=max(pop_tot),
            pop_idoso=sum(Pop)) %>% 
  filter(idosos==1) %>% 
  mutate(prop_idoso=pop_idoso/pop_tot*100) %>% 
  select(Ano, prop_idoso)



criancas <- pop_completo %>% 
  group_by(Ano, faixa) %>% 
  summarise(Pop=sum(Pop)) %>% 
  mutate(crianca=ifelse(faixa %in% "0-4", 1, 0)) %>% 
  group_by(Ano) %>% 
  mutate(pop_tot=sum(Pop))%>% 
  ungroup() %>% 
  group_by(Ano, crianca) %>% 
  summarise(pop_tot=max(pop_tot),
            pop_crianca=sum(Pop)) %>% 
  filter(crianca==1) %>% 
  mutate(prop_crianca=pop_crianca/pop_tot*100) %>% 
  select(Ano, prop_crianca)


jovens <- pop_completo %>% 
  group_by(Ano, faixa) %>% 
  summarise(Pop=sum(Pop)) %>% 
  mutate(jovens=ifelse(faixa %in% c("0-4", "5-9", "10-14"), 1, 0)) %>% 
  group_by(Ano) %>% 
  mutate(pop_tot=sum(Pop))%>% 
  ungroup() %>% 
  group_by(Ano, jovens) %>% 
  summarise(pop_tot=max(pop_tot),
            pop_jovens=sum(Pop)) %>% 
  filter(jovens==1) %>% 
  mutate(prop_jovens=pop_jovens/pop_tot*100) %>% 
  select(Ano, prop_jovens)

  
proporcoes <- criancas %>% 
  left_join(jovens) %>% 
  left_join(idosos) %>% 
  rowwise() %>% 
  mutate(inativos=prop_jovens + prop_idoso,
         ativos=100-inativos,
         RD=inativos/ativos, 
         IE=prop_idoso/prop_jovens*100)

titulo <- "Proporções e indicadores de estrutura por idade, Santa Catarina"

Tab1 <- proporcoes  %>% 
  select(Ano, prop_crianca, prop_jovens, prop_idoso, RD, IE) %>% 
   mutate_if(is.numeric, ~comma(., decimal.mark = ",", accuracy=.01)) 

```



```{r, proporcoes}
Tab1 %>% 
  kable(format="latex", caption=titulo, booktabs = T, 
        linesep="", 
        align=c("c",rep("r",5)),
        col.names=c("Ano","Crianças (%)", "Jovens (%)", "Idosos (%)", 
                    "Razão de Dependência", "Índice de Envelhecimento")) %>% 
  kable_styling(latex_options = "HOLD_position", position="center", 
                full_width = F)%>%  
   column_spec(2:6, width = "6em") %>% 
  footnote("\\\\tiny{Elaboração própria. \n Dados: Censo 1991, 2000, 2010 (DataSus) Projeções 2015, 2020 e 2030 (IBGE)}",  escape=F,  
           footnote_as_chunk=T, general_title ="")

```

Para os dados agrupados foi utilizado o ponto médio de cada classe de idade, sendo que para a classe de $80^+$ foi utilizado o valor de 89,38 anos, baseado na expectativa de vida dessa classe pela tábua de vida do IBGE para 2015. A mediana foi calculada segundo a fórmula para dados agrupados. A média e mediaba podem ser observadas na Tabela \@ref(tab:media), onde vemos o aumento das medidas de centralidade, sendo que a média, influenciada pelos pontos mais extremos se mantém sempre acima da mediana. 

```{r}
# medianas ----

idade_media <- pop_completo %>% 
  group_by(Ano, faixa) %>% 
  summarise(pop_faixa=sum(Pop)) %>% 
  ungroup() %>% 
  group_by(Ano) %>% 
  mutate(pop_tot=sum(pop_faixa),
         prop=pop_faixa/pop_tot) %>% 
  separate(faixa, c("infer", "sup"), remove=F) %>% 
  mutate_at(c("infer", "sup"), ~as.numeric(. )) %>% 
  mutate(ponto_medio=as.numeric(infer+2.5),
         ponto_medio=as.numeric(ifelse(faixa=="80-", 
                                       (ponto_medio+6.88), 
                                       ponto_medio)),
         fator = ponto_medio * prop )%>%
  group_by(Ano) %>% 
  summarise(idade_media=round(sum(fator),1))

idade_mediana_aux <- pop_completo %>% 
  group_by(Ano, faixa) %>% 
  summarise(pop_faixa=sum(Pop)) %>% 
  ungroup() %>% 
  group_by(Ano) %>% 
  mutate(pop_tot=sum(pop_faixa),
         acumulado=cumsum(pop_faixa),
         acum_rel = acumulado/pop_tot,
         metade=pop_tot/2,
         menor=metade>=acumulado,
         f_mediana=pop_faixa/pop_tot) 

idade_mediana_sup <- idade_mediana_aux %>% 
  filter(menor==F) %>% 
  group_by(Ano) %>% 
  arrange(faixa, .by_group = T)%>% 
  slice(1) 


idade_mediana_inf <- idade_mediana_aux %>% 
  filter(menor==T) %>% 
  group_by(Ano) %>% 
  arrange(desc(faixa), .by_group = T)%>% 
  slice(1) 


mediana_junto <-  idade_mediana_inf %>% 
  bind_rows(idade_mediana_sup) %>% 
  arrange(Ano) %>% 
  mutate(infe=as.numeric(str_sub(faixa, 1, 2))) %>%
  select(Ano, faixa, acum_rel, menor, f_mediana, infe) %>%
  mutate(mediana=(infe+ ((50-lag(acum_rel*100))/(f_mediana*100))*5))


idade_media_mediana <-mediana_junto %>% 
  filter(menor==F) %>% 
  select(Ano, mediana) %>% 
  left_join(idade_media)


titulo <- "Idade média e mediana para os anos selecionados, Santa Catarina"
Tab2 <- idade_media_mediana %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", accuracy=.1))  


```

```{r media}
Tab2 %>% 
kable(format="latex", caption=titulo, booktabs = T, 
        linesep="", 
        align=c("c","r", "r"),
        col.names=c("Ano","Mediana (anos)", "Média (anos)")) %>% 
  kable_styling(latex_options = "HOLD_position", position="center", 
                full_width = F) %>%  
   column_spec(1:3, width = "5em") %>% 
  footnote("\\\\tiny{Elaboração própria. \n Dados: Censo (MS:91-00) e Projeções (IBGE:15-30)}",  escape=F,  
           footnote_as_chunk=T, general_title ="")

```


Pelo gráficos da Figura \@ref(fig:razao) vemos que a razão de sexo ao nascer é maior, sendo os homens mais frequentes, e esse limiar se mantém mais ou menos constante até aproximandamente os 20-30 anos, quando o sexo feminino passa a prevalescer.  Isso se dá, como também vemos nas pirâmides, por conta da maior mortalidade para o sexo masculino. Entre 1991 e 2010, essa maior prevalência de mulheres nas idades mais avançadas parece se acentuar, enquanto de 2015 até 2030 a curva da razão de sexos não apresenta fortes mudanças.

```{r, razao, fig.cap="Razão de sexo por grupos de idade para os anos selecionados"}
pop_completo %>% 
  pivot_wider(id_cols = c("Ano", "faixa"),
              names_from = sexo, values_from = Pop) %>% 
  mutate(RS=m/f*100) %>% 
  ggplot(aes(x=factor(faixa), color=Ano, group=Ano))+
  geom_point(aes(y=RS))+
  geom_line(aes(y=RS))+
  facet_wrap(~Ano)+
  theme_bw(base_size = 10)+
  theme(axis.text.x = element_text(angle=90, hjust=1))+
  labs(x="Faixa Etária", y="Homens por 100 mulheres")

```


**c) Avalie a qualidade da declaração de idade no Censo 2010 segundo forma de declaração (data de nascimento e idade presumida). Calcule os índices de Whipple, Myers e Bachi. Construa a pirâmide por idade simples. Comente os resultados.**

Na Tabela \@ref(tab:whipple) a seguir foram calculados os índices para avaliação da declaração de idade por forma de declaração: data de nascimento, idade presumida e os resultados gerais, que são a junção de todos os tipos de declaração. Além disso, os resultados estão discriminados por sexo.

```{r, whipple}
### Tabela com índices de Whipple, Myers e Bachi 
##(calculado na planilha SINGAGE)

quali_dados <- data.frame("Sexo"=c("Homem","Mulher","Total"),
                          "Whipple"=c(1.02,1.02,1.02)*100,
                          "Myers"=c(1,1.2,1.1),
                          "Bachi"=c(0.7,0.7,0.7),
                          "Whipple2"=c(1.25,1.22,1.24)*100,
                          "Myers2"=c(11.7,10.7,11.2),
                          "Bachi2"=c(7.3,6.6,6.9),
                          "Whipple3"=c(1.03,1.02,1.03)*100,
                          "Myers3"=c(1.1,1.2,1.2),
                          "Bachi3"=c(0.8,0.7,0.7))

quali_dados %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", 
                               big.mark = ".")) %>%
  kable(escape = F,format="latex",
        caption = "Índices de Whipple, Myers e Bachi 
        por tipo de declaração da idade, Censo 2010, Santa Catarina", 
        booktabs = TRUE, linesep="", digits=2,
        align=c("l",rep("r",9)),
        col.names=c("Sexo",rep(c("Whipple","Myers",
                                 "Bachi"),3)))  %>%
   kable_styling(latex_options="HOLD_position",
                 position="center") %>% 
  add_header_above(c(" ", "Data de nascimento" = 3, 
                     "Idade presumida" = 3, "Geral" = 3))

```

Nota-se que, para a declaração por meio da data de nascimento, todos os índices revelam que os dados de idade são muito precisos, em ambos os sexos. O resultado é esperado, dado que a declaração por meio da data de nascimento é menos suscetível a erros e atração por dígitos. Nesse sentido, a idade presumida é muito mais suscetível a inconsistências.

De fato, o índice de Whipple expressa que os dados de idade presumida possuem atração pelos dígitos 0 e 5,  indicando que os dados são aproximados para ambos os sexos. Já os índices de Myers e Bachi medem a preferência (rejeição) por cada dígito. Novamente, para idade presumida eles indicam que os dados são imprecisos. Dessa forma, é necessário cautela ao utilizar tais dados.

Por último, unindo todas as declarações de idade, observa-se que os índices possuem bons valores, indicando que não há forte preferência por algum dígito. Isso se deve ao fato de apenas 147.106 indivíduos não terem declarado sua idade por meio da data de nascimento, de um total de 6.248.436 (ou seja, apenas 2,35%). Em suma, os dados gerais de idade apresentam boa qualidade.

```{r}
### Piramide por idade simples

pop_2010_censo <- import("Bases/Tabela_censo_2010_resumida.xls")
pop_2010_censo <-  melt(pop_2010_censo,c("Idade","Total"))  
pop_2010_censo$Idade <- factor(pop_2010_censo$Idade,
                               levels=unique(pop_2010_censo$Idade))

pop_2010_censo$value <- pop_2010_censo$value/1000


labels_idade_simples <- c(as.character(0:99),"100+") 
labels <- labels_idade_simples[seq(1,102,by=5)]
breaks <- pop_2010_censo$Idade[seq(1,102,by=5)]

#age_pyramid(pop_2010_censo, age_group = Idade, split_by = variable,
            #count = value,show_midpoint = F) +
  #scale_fill_manual("Sexo", values=c( "#003366", "#00822E"))+
  #theme_classic(base_size = 10)+
 #scale_x_discrete(labels=labels,breaks=breaks)+
  #theme(
  #    axis.text.x =element_text(angle = 45, hjust=1))+
  #labs(y="mil", x="",fill="")


#ggsave("img/piramide_idade_simples.png",width = 158, height = 93, 
#units="mm", bg="white")

```

\begin{figure}[H]
	\centering
			\caption{Pirâmide por idade simples, 2010, Santa Catarina.}
		\includegraphics[scale = .9]{img/piramide_idade_simples.png}
		\small\textsuperscript{Elaboração Própria. Fonte dos Dados: IBGE - Censo 2010} 
	\label{fig:piram_idade_simples}
\end{figure}

A pirâmide por idade simples, com dados do Censo de 2010, para Santa Catarina não parece revelar forte atração por idades terminadas em 0 ou 5 (ou algum outro dígito em especial). Tal observação corrobora as análises feitas com base nos índices de qualidade vistos anteriormente.

## Parte 2 - Projeção de População

**a) Com base na publicação "Projeções da população : Brasil e unidades da federação : revisão 2018" e na publicação "ESTIMATIVAS DA POPULAÇÃO RESIDENTE PARA OS MUNICÍPIOS E PARA AS UNIDADES DA FEDERAÇÃO COM DATA DE REFERÊNCIA EM 1º DE JULHO DE 2021" comente sobre: Metodologia utilizada para projetar a população do país segundo UF e metodologia para estimar populações dos municípios brasileiros.**

Estimar e projetar a população de uma nação é de suma importância para que os governos possam ter balizadores para a criação, descontinuação, melhorias e gestão de políticas visando assistir a população que nele reside. A seguir, serão apresentados alguns métodos de estimação da população que são utilizados para essas projeções no Brasil.

O método usado para realizar a projeção da população do país segundo cada UF, é chamado de Método das Componentes Demográficas. Este incorpora tendências futuras dos comportamentos dos três principais fatores que são fecundidade, mortalidade e migração. Além disso, o método fornece as projeções populacionais segundo sexo e grupos de idade por meio da equação conhecida como compensadora da demografia ou equação de equilíbrio populacional. Embora sua aplicação não constitua uma tarefa fácil, dado que, para estabelecer suas hipóteses a respeito do futuro das três componentes demográficas, são necessárias informações estatísticas de grande qualidade, observa-se que quanto menor o tamanho da população estudada, mais difícil a obtenção de dados classificados como confiáveis. 

A razão ocorre principalmente pela variabilidade aleatória que pode ocorrer em pequenos domínios. Assim, o Método das Componentes não pode ser aplicado para qualquer tipo de população, somente naquelas que possuem indicadores de fecundidade, mortalidade e migração muito consistentes. Conclui-se que devido a problemas de acessibilidade a informações de qualidade em áreas mais carentes, e, como um todo, sobre a mortalidade, pode ser que esse não seja o método mais indicado para a execução desse tipo de projeção.

Já o método utilizado para estimar populações de municípios se chama Método AiBi, aplicado por Madeira e Simões pela primeira vez no Brasil. Nele, pode-se observar as tendências de crescimento populacional dos municípios, entre dois censos demográficos consecutivos, em relação à tendência de crescimento de uma área geográfica de área maior. Portanto, ele considera que as populações dos domínios menores adotam uma função linear da população de um domínio maior. A desvantagem desse método se dá por não haver barreiras para participações relativas. Assim, podemos ter populações negativas. Contudo, não é recomendado utilizá-lo para projeções populacionais com prospectivas muito extensas. O recomendado para utilização desse método é que o período projetado utilize informações de tempo do mesmo tamanho da passada. 

Em sua teoria, o método é recomendado quando as áreas menores estão apresentando indícios de declínio populacional ou crescimento pequeno, assim como quando o padrão de crescimento populacional nas pequenas áreas não é o mesmo da área maior. O seu uso para projeções dos municípios é compreendido já que, em períodos curtos, o método, na maioria dos casos, aparenta ter todas as ferramentas necessárias para fazer essa estimação com certo grau de precisão. Outro fator é que as projeções de população para cada Unidade da Federação do Brasil são disponibilizadas pelo IBGE por meio do método das componentes demográficas ajuda na projeção dos municípios que se utilizam dessas áreas maiores para então chegar nas informações das áreas.

\newpage

**b) Assumindo população fechada (ausência de migração), projete a população da UF escolhida de 2010 a 2020, segundo o cenário de mortalidade e fecundidade constante . Obtenha indicadores de fecundidade e mortalidade para o período 2014-2016 (nascimentos e óbitos médios do triênio e população projetada pelo IBGE para 2015) . Construa uma tábua de vida e obtenha as taxas específicas de fecundidade.**

```{r}

# PROJECOES IBGE #

projecao_2015 <- read_delim("Bases/projecao_2015.csv", 
                            delim = ";", escape_double = FALSE, 
                            trim_ws = TRUE)

projecao_2020 <- read_delim("Bases/projecao_2020.csv", 
                            delim = ";", escape_double = FALSE, 
                            locale = locale(), 
                            trim_ws = TRUE)

projecao_2030 <- read_delim("Bases/projecao_2030.csv", 
                            delim = ";", escape_double = FALSE,
                            trim_ws = TRUE)

censo_2010 <- read_delim("Bases/censo_2010.csv", 
                            delim = ";", escape_double = FALSE, 
                         trim_ws = TRUE)

```


```{r}

#########################
#### ARRUMANDO DADOS ####
#########################

censo_2010 <- censo_2010 %>% 
  rename(faixa_etaria = "Faixa Etária detalhada") %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"ano(s)?",""),
         faixa_etaria = str_trim(str_replace_all(faixa_etaria,"Menor 1 ",
                                                 "0")),
         faixa_etaria = str_replace_all(faixa_etaria," a ","-"),
         faixa_etaria = str_replace_all(faixa_etaria,"  e mais",
                                        "+")) %>%
  head(-1)

censo_2010 <- censo_2010 %>% 
  slice(1:20) %>% 
  mutate(faixa_etaria = cut(as.numeric(faixa_etaria), 
                            breaks = c(seq(from = 0, to = 20, by = 5)), 
                            right = FALSE, include.lowest = TRUE,
                            labels = c('0-4', '5-9', '10-14', '15-19'))) %>%
  group_by(faixa_etaria) %>% 
  summarise(Masculino = sum(Masculino),
            Feminino = sum(Feminino),
            Total = sum(Total)) %>%
  bind_rows(censo_2010 %>% slice(21:33))
#combinando a manipulacao feita antes com o restante do banco

tabua_masculina_2010 <- readxl::read_xls("Bases/tabuas_mortalidade.xls",
                                         range = "A9:I30", sheet = "SC") %>%
  select(Idade, nLx) %>%
  slice(2:21) 

tabua_feminina_2010 <- readxl::read_xls("Bases/tabuas_mortalidade.xls",
                                         range = "K9:S30", sheet = "SC") %>%
  select(Idade, nLx) %>%
  slice(2:21) 

get_nPx_n <- function(nLx_n, nLx, nPx){
  return((nLx_n/nLx)*nPx) # prob. de sobrevivencia no intervalo x+n --> x+n+m-1
}

```


```{r}

##############################
#### PROJEÇÃO 2010 - 2015 ####
##############################

## Masculino ##

projecao_masculina_2015 <- tabua_masculina_2010 %>% 
  select(Idade, nLx) %>%
  mutate(Idade = str_replace_all(Idade,"80|85|90","80+")) %>%
  slice(18:20) %>%
  group_by(Idade) %>% summarise(nLx = sum(nLx)) %>%
  bind_rows(tabua_masculina_2010 %>% slice(1:17) %>%
              mutate(Idade = as.character(Idade)),.)

projecao_masculina_2015 <- projecao_masculina_2015 %>%
  mutate(Idade = str_replace_all(Idade,"0|1","0")) %>%
  slice(1:2) %>%
  group_by(Idade) %>% summarise(nLx = sum(nLx)) %>%
  bind_rows(projecao_masculina_2015 %>% slice(3:18))

nPx_n_masculino <- c()

for (i in 1:(length(projecao_masculina_2015$Idade))-1) {
  nPx_n_masculino[i+1] <- (projecao_masculina_2015$nLx[i+1]/
                             projecao_masculina_2015$nLx[i])*
    censo_2010$Masculino[i]
} # intervalo etário de x a x+n-1 anos completos

nPx_n_masculino[17] <- (projecao_masculina_2015$nLx[17]/
                          projecao_masculina_2015$nLx[16])*
  (censo_2010$Masculino[17]+censo_2010$Masculino[16])

projecao_masculina_2015 %>%
  mutate(nPx_n = nPx_n_masculino)%>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", 
                               big.mark = ".")) %>%
  kable(caption="Tábua de vida Masculina",
      format= "latex",escape = F, booktabs = TRUE, linesep="",
      col.names = c("Idade","nLx","nPx"),
      align="r") %>%
  kable_styling(latex_options=c("HOLD_position"),
                 position="center") %>% 
  kable_classic(full_width = F)

## Feminino ## 

projecao_feminina_2015 <- tabua_feminina_2010 %>% 
  select(Idade, nLx) %>%
  mutate(Idade = str_replace_all(Idade,"80|85|90","80+")) %>%
  slice(18:20) %>%
  group_by(Idade) %>% summarise(nLx = sum(nLx)) %>%
  bind_rows(tabua_feminina_2010 %>% slice(1:17) %>%
              mutate(Idade = as.character(Idade)),.)

projecao_feminina_2015 <- projecao_feminina_2015 %>%
  mutate(Idade = str_replace_all(Idade,"0|1","0")) %>%
  slice(1:2) %>%
  group_by(Idade) %>% summarise(nLx = sum(nLx)) %>%
  bind_rows(projecao_feminina_2015 %>% slice(3:18))

nPx_n_feminino <- c()

for (i in 1:(length(projecao_feminina_2015$Idade))-1) {
  nPx_n_feminino[i+1] <- (projecao_feminina_2015$nLx[i+1]/
                            projecao_feminina_2015$nLx[i])*
    censo_2010$Feminino[i]
}

#nPx_n_feminino[17] <-
#(projecao_feminina_2015$nLx[17]/(projecao_feminina_2015$nLx[16]+
#projecao_feminina_2015$nLx[17]))*(censo_2010$Feminino[17]+
#censo_2010$Feminino[16])



```

```{r}
projecao_feminina_2015 %>%
  mutate(nPx_n = nPx_n_feminino) %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", 
                               big.mark = ".")) %>%
  kable(caption="Tábua de vida Feminina",
      format= "latex",escape = F, booktabs = TRUE, 
      linesep="",
      col.names = c("Idade","nLx","nPx"),
      align="r") %>%
  kable_styling(latex_options=c("HOLD_position"),
                 position="center") %>% 
  kable_classic(full_width = F)
```


```{r}

## Calculando numero total de nascimentos no quinquenio ##

projecao_2015 <- read_delim("Bases/projecao_2015.csv", 
                            delim = ";", escape_double = FALSE, 
                            trim_ws = TRUE)

projecao_2015 <- projecao_2015 %>% 
  rename(faixa_etaria = "Faixa Etária 1") %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"ano(s)?",""),
         faixa_etaria = str_replace_all(faixa_etaria," a ","-"),
         faixa_etaria = str_replace_all(faixa_etaria,"  e mais","+")) %>%
  head(-1)

projecao_2015 <- projecao_2015 %>% 
  slice(17:19) %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"80-84 ","80+"),
         faixa_etaria = str_replace_all(faixa_etaria,"85-89 ","80+"),
         faixa_etaria = str_replace_all(faixa_etaria,"90","80")
  ) %>%
  group_by(faixa_etaria) %>% 
  summarise(Masculino = sum(Masculino),
            Feminino = sum(Feminino),
            Total = sum(Total)) %>% 
  bind_rows(projecao_2015 %>% slice(1:16), .)

```

```{r}

## Taxa de fecundidade ##

# 2010 - 2015 #

df_2015 <- read_delim("Bases/projecao_2015.csv", 
                                       delim = ";", 
                      escape_double = FALSE, trim_ws = TRUE)


df_2015 <- df_2015 %>% 
  rename(faixa_etaria = "Faixa Etária 1") %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"ano(s)?",""),
         faixa_etaria = str_replace_all(faixa_etaria," a ","-"),
         faixa_etaria = str_replace_all(faixa_etaria,"  e mais","+"),
         faixa_etaria = str_trim(faixa_etaria)) %>%
  head(-1)

pop_feminina_2010 <- censo_2010$Feminino[4:10] #idade fertil
pop_feminina_2015 <- df_2015$Feminino[4:10]
pop_media_2010_2015 <-  bind_cols(pop_feminina_2010, pop_feminina_2015)

DNSC_2010 <- read.dbc("Bases/DNSC2010.DBC")

idade_fem <- DNSC_2010 %>% mutate(classes_idade = cut(as.numeric(IDADEMAE),
                                                      seq(0,100,5),
                                                      labels = NULL,
                                                      include.lowest = T,
                                                      right = F)) %>%
  select(IDADEMAE,classes_idade) %>% group_by(classes_idade) %>% 
  summarise(n = n())

fecundidade <- data.frame("GRUPO ETARIO" = c("15-19", "20-24", 
                                             "25-29", "30-34", "35-39", 
                                             "40-44", "45-49"),
                          freqnascfem = idade_fem$n[2:8]) 
# selecionando grupos de idades no período reprodutivo

f15 <- fecundidade %>% bind_cols(pop_media_2010_2015) %>%
  rename("total_2010"="...3","total_2015"="...4") %>%
  mutate(taxa_fecundidade = freqnascfem/total_2010,
         media=(total_2010+total_2015)/2,
         B_barra=taxa_fecundidade*media) 
#taxas especificas de fecundidade entre t e t+5
#numero medio de nascimentos anuais

```

```{r}
projecao_2015_0_4_anos <- (5*sum(f15$B_barra))*
  projecao_feminina_2015$nLx[1]/(5*100000)
projecao_2015_0_4_anos_masculino <- projecao_2015_0_4_anos*0.512275
projecao_2015_0_4_anos_feminino <- projecao_2015_0_4_anos*0.487725

projecao_feminina_2015 <- projecao_feminina_2015 %>%
  mutate(nPx_n = nPx_n_feminino)

projecao_feminina_2015$nPx_n[1] <- projecao_2015_0_4_anos_feminino

projecao_masculina_2015 <- projecao_masculina_2015 %>%
  mutate(nPx_n = nPx_n_masculino)

projecao_masculina_2015$nPx_n[1] <- projecao_2015_0_4_anos_masculino

projecao_2015_IBGE_feminino <-
  readxl::read_xls("Bases/projecoes_2018_populacao_2010_2060_20200406.xls",
                                                range = "G29:G48", 
                                                sheet = "SC")

projecao_2015_IBGE_masculino <-
  readxl::read_xls("Bases/projecoes_2018_populacao_2010_2060_20200406.xls",
                                                 range = "G6:G25", 
                                                 sheet = "SC")


projecao_2015_IBGE_feminino <- projecao_2015_IBGE_feminino %>% 
  rename("Feminino_IBGE"=`3426676`)

projecao_2015_IBGE_feminino$Feminino_IBGE[17] <-
  sum(projecao_2015_IBGE_feminino$Feminino_IBGE[17],
      projecao_2015_IBGE_feminino$Feminino_IBGE[18],
      projecao_2015_IBGE_feminino$Feminino_IBGE[19]) # 80+

projecao_2015_IBGE_feminino <- projecao_2015_IBGE_feminino %>% 
  slice(1:17) 
#juntar com demais faixas

projecao_2015_IBGE_masculino <- projecao_2015_IBGE_masculino %>% 
  rename("Masculino_IBGE"=`3375630`)

projecao_2015_IBGE_masculino$Masculino_IBGE[17] <-
  sum(projecao_2015_IBGE_masculino$Masculino_IBGE[17],
      projecao_2015_IBGE_masculino$Masculino_IBGE[18],
      projecao_2015_IBGE_masculino$Masculino_IBGE[19])

projecao_2015_IBGE_masculino <- projecao_2015_IBGE_masculino %>% slice(1:17)

tab1Jes<-projecao_feminina_2015 %>%
  bind_cols(censo_2010$faixa_etaria,projecao_2015_IBGE_masculino, projecao_masculina_2015, projecao_2015_IBGE_feminino) %>%
  rename("Faixa etária"="...4") %>% select(`Faixa etária`, nPx_n...3,
                                           Feminino_IBGE, nPx_n...8, 
                                           Masculino_IBGE) %>%
  mutate(total_projecao_propria = nPx_n...3+nPx_n...8,
         total_IBGE = Feminino_IBGE+Masculino_IBGE) %>%
      mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
      kable(caption="Projeção, segundo sexo. Santa Catarina - 1991, 2000, 
            2010, 2015, 2020 e 2030.",
      format= "latex", booktabs = TRUE, linesep="",
      col.names = c("Faixa etária","Projeção Fem.","Projeção IBGE Fem.", 
                    "Projeção Masc.","Projeção IBGE Masc.","Própria total",
                    "IBGE total"),
      align="r") %>%
  #column_spec(2:6, width = "5em") %>%
  kable_styling(latex_options=c("HOLD_position","scale_down"), 
                position="center") %>% 
  footnote(general=c("Elaboração própria", 
                     "Censo 1991, 2000, 2010 (DataSus)", 
                     "Projeções 2015, 2020 e 2030 (IBGE)"),  
           footnote_as_chunk=F, general_title ="", 
           fixed_small_size = T) %>% 
  kable_classic(full_width = F)
```

```{r}
##############################
#### PROJEÇÃO 2015 - 2020 ####
##############################

nLx_masculino_TP1 <- c(100285.699+388578.668, 483464.432, 482643.729,
                       483943.467, 477182.758, 464598.489, 454005.005,
                       442354.036, 430923.632,414554.745, 388840.564,
                       354334.568, 306371.676, 247629.000, 177397.209,
                       109011.183, 50891.787+14873.633+1021.977) 

# valores retirados das tabuas de vida do trabalho 1

nLx_feminino_TP1 <- c(100224.679+390328.758, 486448.771, 485406.688,
                      484579.019, 482320.324, 478696.588, 474774.797,
                      470094.589, 462963.732, 452199.198, 437547.092,
                      415282.668, 385109.201, 343464.885, 287852.122,
                      218361.179, 137413.451+61201.615+7446.397)

# valores retirados das tabuas de vida do trabalho 1
```


```{r}

df_2015 <- read_csv2("Bases/projecao_2015.csv")

df_2015 <- df_2015 %>% 
  rename(faixa_etaria = "Faixa Etária 1") %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"ano(s)?",""),
         faixa_etaria = str_replace_all(faixa_etaria," a ","-"),
         faixa_etaria = str_replace_all(faixa_etaria,"  e mais","+")) %>%
  head(-1)

df_2015 <- df_2015 %>% 
  slice(17:19) %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"80-84 ","80+"),
         faixa_etaria = str_replace_all(faixa_etaria,"85-89 ","80+"),
         faixa_etaria = str_replace_all(faixa_etaria,"90","80")
  ) %>%
  group_by(faixa_etaria) %>% 
  summarise(Masculino = sum(Masculino),
            Feminino = sum(Feminino),
            Total = sum(Total)) %>% 
  bind_rows(df_2015 %>% slice(1:16), .) %>%
  mutate(faixa_etaria = str_trim(faixa_etaria))

Idade <- df_2015$faixa_etaria

df_2020 <- read_csv2("Bases/projecao_2020.csv")

df_2020 <- df_2020 %>% 
  rename(faixa_etaria = "Faixa Etária 1") %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"ano(s)?",""),
         faixa_etaria = str_replace_all(faixa_etaria," a ","-"),
         faixa_etaria = str_replace_all(faixa_etaria,"  e mais","+")) %>%
  head(-1)

df_2020 <- df_2020 %>% 
  slice(17:19) %>%
  mutate(faixa_etaria = str_replace_all(faixa_etaria,"80-84 ","80+"),
         faixa_etaria = str_replace_all(faixa_etaria,"85-89 ","80+"),
         faixa_etaria = str_replace_all(faixa_etaria,"90","80")
  ) %>%
  group_by(faixa_etaria) %>% 
  summarise(Masculino = sum(Masculino),
            Feminino = sum(Feminino),
            Total = sum(Total)) %>% 
  bind_rows(df_2020 %>% slice(1:16), .)

pop_feminina_2015 <- df_2015$Feminino
pop_masculina_2015 <- df_2015$Masculino

pop_feminina_2015 <- df_2015$Feminino[4:10] #idade fertil
pop_feminina_2020 <- df_2020$Feminino[4:10]
pop_media_2020_2015 <-  bind_cols(pop_feminina_2020, pop_feminina_2015)

```


```{r}

#### Natalidade

DNSC_2015 <- read.dbc("Bases/DNSC2015.dbc")

idade_fem <- DNSC_2015 %>% 
  mutate(classes_idade = cut(as.numeric(IDADEMAE),
                             seq(0,100,5),
                             labels = NULL,
                             include.lowest = T,
                             right = F)) %>%
  select(IDADEMAE,classes_idade) %>% group_by(classes_idade) %>% 
  summarise(n = n())

fecundidade <- data.frame("GRUPO ETARIO" = c("15-19", "20-24", "25-29", 
                                             "30-34", "35-39", "40-44",
                                             "45-49"),
                          freqnascfem = idade_fem$n[2:8])

f20 <- fecundidade %>% bind_cols(pop_media_2020_2015) %>%
  rename("total_2020"="...3","total_2015"="...4") %>%
  mutate(taxa_fecundidade = freqnascfem/total_2015,
         media=(total_2020+total_2015)/2,
         B_barra=taxa_fecundidade*media)
```

```{r}

## Masculino ##

projecao_masculina_2020 <- bind_cols(Idade, nLx_masculino_TP1) %>% 
  rename("Idade"="...1","nLx"="...2")

nPx_n_masculino_2020 <- c()

for (i in 1:(length(projecao_masculina_2020$Idade))-1) {
  nPx_n_masculino_2020[i+1] <- (projecao_masculina_2020$nLx[i+1]/
                                  projecao_masculina_2020$nLx[i])*
    (pop_masculina_2015[i])
}

projecao_masculina_2020 <- projecao_masculina_2020 %>%
  mutate(nPx_n = nPx_n_masculino_2020)

## Feminino ##

projecao_feminina_2020 <- bind_cols(Idade, nLx_feminino_TP1) %>% 
  rename("Idade"="...1","nLx"="...2")

nPx_n_feminino_2020 <- c()

for (i in 1:(length(projecao_feminina_2020$Idade))-1) {
  nPx_n_feminino_2020[i+1] <- (projecao_feminina_2020$nLx[i+1]/
                                 projecao_feminina_2020$nLx[i])*
    df_2015$Feminino[i]
}

projecao_feminina_2020 <- projecao_feminina_2020 %>%
  mutate(nPx_n = nPx_n_feminino_2020)

projecao_2020_0_4_anos <- (5*sum(f20$B_barra))*nLx_feminino_TP1[1]/(5*100000)
projecao_2020_0_4_anos_masculino <- projecao_2020_0_4_anos*0.5130885
projecao_2020_0_4_anos_feminino <- projecao_2020_0_4_anos*0.4868601

projecao_feminina_2020$nPx_n[1] <- projecao_2020_0_4_anos_feminino
projecao_masculina_2020$nPx_n[1] <- projecao_2020_0_4_anos_masculino

```

```{r}

# projecoes do IBGE 

#feminino 
projecao_2020_IBGE_feminino <-
  readxl::read_xls("Bases/projecoes_2018_populacao_2010_2060_20200406.xls",
                                                range = "L29:L48", 
                                                sheet = "SC")

projecao_2020_IBGE_masculino <-
  readxl::read_xls("Bases/projecoes_2018_populacao_2010_2060_20200406.xls",
                                                 range = "L6:L25", 
                                                 sheet = "SC")

projecao_2020_IBGE_feminino <-
  projecao_2020_IBGE_feminino %>% 
  rename("Feminino_IBGE"=`3654387`)

projecao_2020_IBGE_feminino$Feminino_IBGE[17] <-
  sum(projecao_2020_IBGE_feminino$Feminino_IBGE[17],
      projecao_2020_IBGE_feminino$Feminino_IBGE[18],
      projecao_2020_IBGE_feminino$Feminino_IBGE[19])


projecao_2020_IBGE_feminino <- projecao_2020_IBGE_feminino %>% slice(1:17)

#masculino
projecao_2020_IBGE_masculino <- projecao_2020_IBGE_masculino %>% 
  rename("masculino_IBGE"=`3598115`)

projecao_2020_IBGE_masculino$masculino_IBGE[17] <-
  sum(projecao_2020_IBGE_masculino$masculino_IBGE[17],
      projecao_2020_IBGE_masculino$masculino_IBGE[18],
      projecao_2020_IBGE_masculino$masculino_IBGE[19])


projecao_2020_IBGE_masculino <- projecao_2020_IBGE_masculino %>% slice(1:17)

tab2Jes<-projecao_feminina_2020 %>% 
  bind_cols(Idade,
            projecao_2020_IBGE_feminino, 
            projecao_masculina_2020, 
            projecao_2020_IBGE_masculino) %>%
  rename("Faixa etária"="...4") %>% select(`Faixa etária`, nPx_n...3, 
                                           Feminino_IBGE, nPx_n...8, 
                                           masculino_IBGE) %>%
  mutate(total_projecao_proprica = nPx_n...3+nPx_n...8,
         total_IBGE = Feminino_IBGE+masculino_IBGE) %>%
  kbl(caption="Projeção, segundo sexo. Santa Catarina - 1991, 2000, 
      2010, 2015, 2020 e 2030.",
      format= "latex",
      col.names = c("Faixa etária","Projeção Fem","Projeção IBGE fem", 
                    "Projeção Masc","Projeção IBGE masc",
                    "propria_total","propria_IBGE"),
      align="r") %>%
  kable_classic(full_width = F, html_font = "helvetica")

```

```{r}
### Taxas específicas de fecundidade -----
populacao <- read_excel("Bases/populacao_Sc.xls")

pop_grupos <- populacao %>% 
  select(IDADE, Sexo, "2015") %>% 
  mutate(IDADE=str_replace(IDADE, "\\+", "")) %>% 
  mutate(IDADE=as.numeric(IDADE)) %>% 
  mutate(faixa=cut(IDADE, breaks=c(-1, 1, 5, 10, 15, 20,
                                   25, 30, 35, 40, 45, 50, 
                                   55, 60, 65, 70, 75, 80, 
                                   85,90,  200), 
                   labels=c("<1", "1-4", "5-9", "10-14", "15-19",
                            "20-24", "25-29", "30-34", "35-39", 
                            "40-44", "45-49", "50-54", "55-59",
                            "60-64", "65-69", "70-74", "75-79", 
                            "80-84", "85-89", ">90"), right=F)) %>% 
  pivot_longer(cols=c("2015"), names_to = "Ano", 
               values_to = "Pop") %>% 
  group_by(Ano, Sexo, faixa) %>% 
  summarise(Pop=sum(Pop)) %>% 
  pivot_wider(id_cols=c(Sexo, faixa), 
              names_from = Ano, values_from = Pop) 


arquivos_nasc <- str_c("Bases/", 
                       list.files(path="Bases/", pattern="^TP2"))

nascimentos <-  map_dfr(arquivos_nasc,~ read.dbc(.x)) %>% 
  mutate_all(~as.character(.))

nascimentos_trat <- nascimentos %>% 
  select(IDADEMAE, DTNASC, SEXO, DTNASCMAE) %>% 
  mutate(DTNASC=dmy(DTNASC),
         DTNASCMAE=dmy(DTNASCMAE),
         IDADEMAE=as.numeric(IDADEMAE)) %>% 
  mutate(Ano=as.character(year(DTNASC)),
         faixa=cut(IDADEMAE, breaks=c(-1, 1, 5, 10, 15, 20,
                                      25, 30, 35, 40, 45, 50, 
                                      55, 60, 65, 70, 75, 80, 
                                      85,90,  200), 
                   labels=c("<1", "1-4", "5-9", "10-14", "15-19",
                            "20-24", "25-29", "30-34", "35-39", 
                            "40-44", "45-49", "50-54", "55-59",
                            "60-64", "65-69", "70-74", "75-79", 
                            "80-84", "85-89", ">90"), right=F))


pop_fem_fertil <- pop_grupos %>% 
  filter(Sexo=="F", 
         faixa %in% c("15-19", "20-24", "25-29",
                      "30-34", "35-39", "40-44",
                      "45-49")) 

pop_fem_fertil_faixa <- pop_fem_fertil %>% 
  pivot_longer(c("2015"),
               names_to = "Ano", values_to = "Pop") 

nascimentos_medio <- nascimentos_trat %>% 
  group_by(faixa,Ano) %>% 
  count(name = "nasc") %>% 
  group_by(faixa) %>%
  summarise(nasc_medio=mean(nasc))

nascimentos_medio$Ano <- "2015"

nfx <- nascimentos_medio %>% 
  right_join(pop_fem_fertil_faixa) %>% 
  mutate(nfx = round(nasc_medio/Pop*1000,2)) %>% 
  select(Ano, faixa, nfx) %>% 
  pivot_wider(id_cols = faixa, 
              names_from = Ano, 
              values_from = nfx) 
```

```{r, fecundidade}
nfx %>%
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", 
                               big.mark = ".", accuracy=.01)) %>%
  kableExtra::kbl(.,align=c('c','c'),booktabs = T,format= "latex",
                  caption = 'Taxas específicas de fecundidade com média de três anos centrada
em 2015 - Santa Catarina',col.names=c("Faixa etária","nfx (mil hab.)") ) %>% 
  kableExtra::kable_classic(full_width=FALSE,latex_options = "HOLD_position") %>%
    footnote("\\\\tiny{Elaboração própria. \nFonte dos Dados: Ministério da Saúde}",  escape=F, 
           footnote_as_chunk=T, general_title ="")
```


Na Tabela \@ref(tab:projec1) estão apresentadas as projeções populacionais para 2015, enquanto na Tabela \@ref(tab:projec2) estão os resultados para 2020. As projeções realizadas pelo IBGE para a UF (revisão de 2018) também estão presentes nas Tabelas \@ref(tab:projec1) e \@ref(tab:projec2), a título de comparação com os resultados obtidos.

A projeção realizada levou em conta os fatores de separação ${}_nk_x$ calculados no Trabalho 1, por meio dos microdados de mortalidade. As taxas específicas de fecundidade e mortalidade foram calculadas com a média do triênio 2014-2016, levando em consideração a população centrada em 2015. As TEFs consideradas estão presentes na Tabela \@ref(tab:fecundidade).

É possível observar que os projeções feitas neste trabalho não se distanciaram muito das projeções do IBGE. Entretanto, em todas as faixas etárias, tanto em 2015 quanto 2020, a população projetada pelo IBGE foi maior do que a obtida na elaboração própria. Tal divergência deve-se, provavelmente, ao fato de que a projeção própria não levou em consideração os fluxos migratórios.

Sabidamente, Santa Catarina é um estado se formou com forte influência da migração internacional, especialmente com a formação das antigas colônias alemãs. Atualmente, o estado apresenta bons indicadores de qualidade de vida e um potencial de atração de migrantes. Nesse sentido, os indicadores da projeção do IBGE - revisão de 2018 - estimaram para 2020 um saldo migratório positivo para Santa Catarina, com 28.013 imigrantes provenientes da migração interna. Além disso, o estado também foi destino de emigrantes haitianos, em especial a partir de 2010, como pode ser visto em \citeonline{magalhaes2017imigraccao}. Desse modo, fica claro que supor ausência de migração para as projeções resultou em um impacto importante nos resultados.



\begin{table}[H]
\caption{Projeção da população de 2015 em Santa Catarina, por sexo.}
\centering
\begin{tabular}{crrrrrr}
\hline
\multirow{2}{*}{\textbf{\begin{tabular}[c]{@{}c@{}}Faixa \\ etária\end{tabular}}} & \multicolumn{2}{c}{\textbf{Feminina}}                                                     & \multicolumn{2}{c}{\textbf{Masculina}}                                                    & \multicolumn{2}{c}{\textbf{Total}}                                                        \\ \cline{2-7} 
                                                                                  & \multicolumn{1}{c}{\begin{tabular}[c]{@{}c@{}}Elaboração\\ Própria\end{tabular}} & IBGE   & \multicolumn{1}{c}{\begin{tabular}[c]{@{}c@{}}Elaboração\\ Própria\end{tabular}} & IBGE   & \multicolumn{1}{c}{\begin{tabular}[c]{@{}c@{}}Elaboração\\ Própria\end{tabular}} & IBGE   \\ \hline
0-4                                                                               & 207.856                                                                           & 222.987 & 218.319                                                                           & 233.457 & 426.175                                                                           & 456.444 \\
5-9                                                                               & 198.553                                                                           & 213.404 & 206.533                                                                           & 223.007 & 405.086                                                                           & 436.411 \\
10-14                                                                             & 213.640                                                                           & 224.751 & 222.705                                                                           & 234.590 & 436.345                                                                           & 459.341 \\
15-19                                                                             & 254.483                                                                           & 264.423 & 264.017                                                                           & 274.105 & 518.500                                                                           & 538.528 \\
20-24                                                                             & 268.447                                                                           & 282.124 & 274.237                                                                           & 290.336 & 542.684                                                                           & 572.460 \\
25-29                                                                             & 277.635                                                                           & 293.208 & 285.056                                                                           & 304.204 & 562.692                                                                           & 597.412 \\
30-34                                                                             & 279.369                                                                           & 292.493 & 283.829                                                                           & 299.193 & 563.199                                                                           & 591.686 \\
35-39                                                                             & 253.646                                                                           & 263.406 & 253.531                                                                           & 264.436 & 507.177                                                                           & 527.842 \\
40-44                                                                             & 235.022                                                                           & 243.117 & 231.025                                                                           & 239.427 & 466.048                                                                           & 482.544 \\
45-49                                                                             & 231.848                                                                           & 239.021 & 225.342                                                                           & 232.702 & 457.190                                                                           & 471.723 \\
50-54                                                                             & 221.582                                                                           & 227.882 & 210.203                                                                           & 216.388 & 431.786                                                                           & 444.270 \\
55-59                                                                             & 183.198                                                                           & 188.473 & 171.697                                                                           & 176.683 & 354.896                                                                           & 365.156 \\
60-64                                                                             & 147.631                                                                           & 151.649 & 134.994                                                                           & 138.751 & 282.626                                                                           & 290.400 \\
65-69                                                                             & 110.376                                                                           & 113.403 & 97.043                                                                            & 99.818  & 207.419                                                                           & 213.221 \\
70-74                                                                             & 76.838                                                                            & 79.059  & 63.107                                                                            & 65.090  & 139.946                                                                           & 144.149 \\
75-79                                                                             & 55.948                                                                            & 57.682  & 41.399                                                                            & 42.765  & 97.348                                                                            & 100.447 \\
80+                                                                               & 59.051                                                                            & 69.594  & 36.538                                                                            & 40.678  & 95.590                                                                            & 110.272 \\
\hline
\end{tabular}
\label{tab:projec1}
\small\textsuperscript{Elaboração Própria. Fonte dos Dados: Ministério da Saúde }
\end{table}



\begin{table}[H]
\caption{Projeção da população de 2020 em Santa Catarina, por sexo.}
\centering
\begin{tabular}{crrrrrr}
\hline
\multirow{2}{*}{\textbf{\begin{tabular}[c]{@{}c@{}}Faixa \\ etária\end{tabular}}} & \multicolumn{2}{c}{\textbf{Feminina}}                                 & \multicolumn{2}{c}{\textbf{Masculina}}                                & \multicolumn{2}{c}{\textbf{Total}}                                    \\ \cline{2-7} 
                                                                                  & \begin{tabular}[c]{@{}c@{}}Elaboração\\ Própria\end{tabular} & IBGE   & \begin{tabular}[c]{@{}c@{}}Elaboração\\ Própria\end{tabular} & IBGE   & \begin{tabular}[c]{@{}c@{}}Elaboração\\ Própria\end{tabular} & IBGE   \\ \hline
0-4                                                                               & 233.970                                                       & 237.651 & 246.575                                                       & 248.937 & 480.545                                                       & 486.588 \\
5-9                                                                               & 212.693                                                       & 227.142 & 222.143                                                       & 237.316 & 434.837                                                       & 464.458 \\
10-14                                                                             & 225.994                                                       & 218.251 & 236.078                                                       & 227.603 & 462.073                                                       & 445.854 \\
15-19                                                                             & 244.846                                                       & 230.601 & 256.363                                                       & 240.036 & 501.210                                                       & 470.637 \\
20-24                                                                             & 269.448                                                       & 273.363 & 279.749                                                       & 284.044 & 549.197                                                       & 557.407 \\
25-29                                                                             & 286.316                                                       & 292.575 & 297.387                                                       & 302.668 & 583.704                                                       & 595.243 \\
30-34                                                                             & 286.655                                                       & 301.175 & 299.142                                                       & 312.898 & 585.798                                                       & 614.073 \\
35-39                                                                             & 284.202                                                       & 297.353 & 293.769                                                       & 303.540 & 577.972                                                       & 600.893 \\
40-44                                                                             & 248.928                                                       & 266.593 & 253.986                                                       & 266.167 & 502.915                                                       & 532.760 \\
45-49                                                                             & 230.044                                                       & 244.853 & 230.665                                                       & 239.380 & 460.709                                                       & 484.233 \\
50-54                                                                             & 223.899                                                       & 238.948 & 218.517                                                       & 229.980 & 442.416                                                       & 468.928 \\
55-59                                                                             & 210.544                                                       & 225.919 & 199.514                                                       & 210.889 & 410.058                                                       & 463.808 \\
60-64                                                                             & 169.373                                                       & 184.738 & 153.072                                                       & 168.893 & 322.445                                                       & 353.631 \\
65-69                                                                             & 130.916                                                       & 146.058 & 111.329                                                       & 128.792 & 242.246                                                       & 274.850 \\
70-74                                                                             & 91.814                                                        & 106.080 & 69.460                                                        & 88.467  & 161.275                                                       & 194.547 \\
75-79                                                                             & 57.652                                                        & 70.570  & 38.463                                                        & 53.602  & 96.116                                                        & 124.172 \\
80+                                                                               & 52.094                                                        & 92.517  & 24.729                                                        & 54.903  & 76.824                                                        & 147.420 \\
\hline
\end{tabular}
\label{tab:projec2}
\small\textsuperscript{Elaboração Própria. Fonte dos Dados: Ministério da Saúde }
\end{table}


**c) No link estão disponíveis as projeções da população por sexo e idade para o Brasil (2010-2060) e para as Unidades da Federação - revisão 2018, realizadas pelo IBGE. Com base nessas informações, construa e compare as pirâmides resultantes para os anos de 2010, 2020 e 2060 para o Brasil.**


```{r}
projec_homens <-  readxl::read_xls("Bases/projecoes_2018_anos_selecionados.xls",
                                   sheet="BRASIL-Homens")
projec_mulheres <- readxl::read_xls("Bases/projecoes_2018_anos_selecionados.xls",
                                    sheet="BRASIL-Mulheres")

projec_homens$Sexo <- "Masculino"
projec_mulheres$Sexo <- "Feminino"

projec_homens <- melt(projec_homens,c("GRUPO ETÁRIO","Sexo"))
projec_mulheres <-  melt(projec_mulheres,c("GRUPO ETÁRIO","Sexo"))

projec_total <- rbind(projec_homens,projec_mulheres)
projec_total$`GRUPO ETÁRIO` <- factor(projec_total$`GRUPO ETÁRIO`,
                                      levels=unique(projec_total$`GRUPO ETÁRIO`))
projec_total$Sexo <- factor(projec_total$Sexo,levels=c("Masculino","Feminino"))
projec_total$pop_milhao <- projec_total$value/1000000

# Construindo as piramides para o Brasil 2010, 2020 e 2060
plot_piramide_2010 <- projec_total %>% filter(variable=="2010") %>%
                      apyramid::age_pyramid(.,age_group="GRUPO ETÁRIO",
                                            split_by="Sexo",
                                            count="pop_milhao",
                                            show_midpoint = F) +
                      theme_classic(base_size = 10)+
                      theme(axis.text.x =element_text(angle = 45, hjust=1))+
                      labs(y="milhões", x="",title="2010")

plot_piramide_2020 <- projec_total %>% filter(variable=="2020") %>%
                      apyramid::age_pyramid(.,age_group="GRUPO ETÁRIO",
                                            split_by="Sexo",
                                            count="pop_milhao",
                                            show_midpoint = F) +
                      theme_classic(base_size = 10)+
                      theme(axis.text.x =element_text(angle = 45, hjust=1))+
                      labs(y="milhões", x="",title="2020")

plot_piramide_2060 <- projec_total %>% filter(variable=="2060") %>%
                      apyramid::age_pyramid(.,age_group="GRUPO ETÁRIO",
                                            split_by="Sexo",
                                            count="pop_milhao",
                                            show_midpoint = F) +
                      theme_classic(base_size = 10)+
                      theme(axis.text.x =element_text(angle = 45, hjust=1))+
                      labs(y="milhões", x="",title="2060")

# Montando painel com as 3 piramides

#cowplot::plot_grid(plot_piramide_2010,plot_piramide_2020,
#                   plot_piramide_2060,nrow=2)

#ggsave("img/painel_2_c.png",width = 178, height = 143, 
#units = "mm", bg="white")
```


\begin{figure}[h!]
	\centering
			\caption{Pirâmides etárias, Brasil, 2010, 2020 e 2060}
		\includegraphics[scale = .9]{img/painel_2_c.png}
		\small\textsuperscript{Elaboração Própria. Fonte dos Dados: IBGE - Projeções da população, revisão de 2018} 
	\label{fig:painel2c}
\end{figure}

As pirâmides etárias para o Brasil, anos de 2010, 2020 e 2060 estão presentes na Figura \@ref(fig:painel2c). A evolução das pirâmides etárias revelam as fases da transição demográfica pela qual o país está passando. Na pirâmide etária de 2010, era possível observar uma base larga, caracterizada por uma alta proporção de crianças e jovens. Essa configuração era resultado da alta taxa de fecundidade que o Brasil apresentava nas décadas anteriores.

Já na projeção de 2020, há uma diminuição gradual na proporção de crianças e jovens, indicando uma queda na taxa de natalidade. A parte central da pirâmide, representando adultos em idade produtiva, foi ampliada, refletindo um processo de envelhecimento populacional. Além disso, a parcela de idosos aumentou em comparação com a década anterior. Essa mudança é resultado de vaŕios fatores, entre eles é possível citar a redução da fecundidade e avanços na área da saúde.

As projeções para 2060 sugerem uma transformação ainda mais pronunciada na pirâmide etária brasileira. A base da pirâmide se torna mais estreita, refletindo uma taxa de natalidade baixa ou até mesmo abaixo do nível de reposição. A proporção de jovens será substancialmente menor em comparação com as décadas anteriores. Por outro lado, a faixa etária acima dos 60 anos apresentará um aumento expressivo, indicando um processo acelerado de envelhecimento populacional. A expectativa de vida mais longa e o declínio na taxa de mortalidade são fatores que contribuem para esse cenário.

Alguns indicadores da dinâmica populacional estão apresentados na Tabela \@ref(tab:dinamica). Também foram selecionados alguns indicadores da estrutura populacional, disponíveis na Tabela \@ref(tab:estrutura).

```{r, dinamica}
# Colocando os indicadores do IBGE em tabelas
# disponivel em projecoes_2018_indicadores.xls

# Indicadores da dinâmica populacional
tbl_dinam_pop <- data.frame("Ano"=c("2010","2020","2060"),
                            "TCG (%)"=c("-","0,77","-0,31"),
                            "TBN (por mil hab.)" = c("15,08","13,99","9,29"),
                            "TBM (por mil hab.)" = c("6,36","6,56","12,51"),
                            check.names = F)

tbl_dinam_pop %>%
  kable(format="latex",
        caption = "Indicadores da dinâmica populacional para o Brasil, 
        anos de 2010, 2020 e 2060", booktabs = T, linesep="",
        align=c('l','r','r','r'))  %>%
   kable_styling(latex_options=c("HOLD_position"),
                 position="center") %>% 
  footnote("\\\\tiny{Elaboração própria. \n Dados: IBGE - 
           Projeções da população, revisão de 2018}",  escape=F, 
           footnote_as_chunk=T, general_title ="")
```

```{r, estrutura}
# Indicadores de estrutura da populacao
# disponivel em projecoes_2018_indicadores.xls
# Razão de dependência, Índice de envelhecimento e Idade mediana

tbl_estrutura <- data.frame("Ano"=c("2010","2020","2060"),
                            "Idade mediana"=c("29,20","33,40","45,62"),
                            "Índice de envelhecimento (%)" = c("29,55","46,89","173,47"),
                            "Razão de dependência total (%)" = c("47,09","44,29","67,23"),
                            check.names = F)

tbl_estrutura %>%
  kable(format="latex",caption = "Indicadores de estrutura populacional 
        para o Brasil, anos de 2010, 2020 e 2060", booktabs = T, linesep="",
        align=c('l','r','r','r'))  %>%
   kable_styling(latex_options=c("HOLD_position","scale_down"), 
                 position="center", full_width = F) %>% 
  footnote("\\\\tiny{Elaboração própria. \n Dados: IBGE - Projeções da 
           população, revisão de 2018}",  escape=F,  
           footnote_as_chunk=T, general_title ="")
```


Os indicadores apresentados reforçam as tendências vistas por meio das pirâmides. Assim, destaca-se uma contínua queda na Taxa Bruta de Natalidade (TBN), chegando a 9,29 nascimentos por mil habitantes em 2060. Esse valor é reflexo da diminuição das taxas de fecundidade e da própria mudança na dinâmica da fecundidade, como o adiamento da maternidade. Já a Taxa Bruta de Mortalidade (TBM) cresce ao passar dos anos, e como um dos reflexos, em 2060 a Taxa de Crescimento Geométrico chega a ser negativa (-0,31).

O aumento da idade mediana para 45,62 em 2060 evidencia o processo de envelhecimento, assim como o aumento expressivo do índice de envelhecimento. Por fim, a razão de dependência total (jovens e idosos) passa por uma pequena queda de 2010 para 2020, seguida de um aumento considerável em 2060, o que evidencia o fim da janela de oportunidades.


Tais mudanças na estrutura etária têm implicações significativas para a sociedade. O envelhecimento da população coloca desafios adicionais para o sistema de seguridade social, como a previdência e a saúde, uma vez que há menos pessoas em idade ativa para sustentar a população idosa. Além disso, a redução na fecundidade tem implicações no mercado de trabalho e na dinâmica social do país.


\newpage

# Apêndice

Código utilizado na análise.

```{r ref.label=knitr::all_labels(), echo=FALSE, eval=FALSE}
```