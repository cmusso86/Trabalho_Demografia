---
titulo: "Trabalho Demografia"
subtitulo: "Santa Catarina"
aluno1:  "Carolina Musso 18/0047850"
aluno2: "Laura Teixeira 19/0016051"
aluno3: "Jéssica Vasconcelos 18/0048708"
aluno4: "Leonardo"
orientador: "Ana Maria Nogales"
ano: "1/2023"
referencias: referencias.bib
output: 
  bookdown::pdf_document2:
    template: template.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)
```

```{r}
# Carregando bibliotecas ---------

pacman::p_load(foreign,tidyverse, LexisPlotR, readxl, janitor, kableExtra, scales, reshape2, cowplot, ggmosaic)
pacman::p_load_gh("danicat/read.dbc")

# Dados -------

arquivos_nasc <- str_c("Bases/", 
                  list.files(path="Bases/", pattern="^DNS"))

nascimentos <-  map_dfr(arquivos_nasc,~ read.dbc(.x)) %>% 
  mutate_all(~as.character(.))

obitos <- readRDS("Bases/dados_SIM.rds")


populacao <- read_excel("Bases/populacao_Sc.xls")

mortalidade <- readRDS("dados_SIM.rds")

ibge_indicadores <- read_excel("Bases/indicadores_IBGE_SC.xlsx")


```

# Introdução

O estado brasileiro de Santa Catarina tem como capital a ilha de Floranópolis e está localizado no centro da região sul do país. O estado faz fronteira ao norte com o Paraná e ao sul pelo Rio Grande do Sul. É banhado ao leste pelo Oceano Atlântico e e ao oeste faz fronteira com a Argentina. Sua área abrange 95.736,165 km² (https://www.ibge.gov.br/cidades-e-estados) e possui uma população de mais de 6 milhões de habitantes , sendo o décimo estado mais populoso do Brasil (https://ftp.ibge.gov.br/Estimativas_de_Populacao/Estimativas_2021/estimativa_dou_2021.pdf). O estado possui 295 municípios, sendo Joinville, Florianópolis, Blumenau, Criciúma e Chapecó as principais cidades.

Santa Catarina possui índices sociais muito elevados em comparação com o restante do Brasil. É o estado com a maior expectativa de vida, empatando com o Distrito Federal. Além disso, possui a menor taxa de mortalidade infantil e é o estado com menor desigualdade econômica e analfabetismo no país. Em termos econômicos, Santa Catarina possui o sexto maior Produto Interno Bruto (PIB) do Brasil e o quarto maior PIB per capita, ficando atrás apenas do Distrito Federal, São Paulo e Mato Grosso. Sua economia é diversificada e tem uma forte ênfase na industrialização. O estado é um importante polo de exportação e consumo, sendo um dos maiores contribuintes para o crescimento da economia brasileira, representando 4% do PIB nacional (https://agenciadenoticias.ibge.gov.br/agencia-sala-de-imprensa/2013-agencia-de-noticias/releases/17999-contas-regionais-2015-queda-no-pib-atinge-todas-as-unidades-da-federacao-pela-primeira-vez-na-serie).

O tema desse trabalho é a dinâmica demográfica, com a análise de dois componentes: a natalidade/fecundidade e a mortalidade do estado de Santa Catarina. 

# Objetivos

- Aplicar os conceitos e técnicas para análise de componentes de natalidade,  fecundidade e mortalidade a dados reais do estado de Santa Catarina. 

- Aplicar os conceitos e técnicas para a análise das componentes natalidade e fecundidade e mortalidade a dados reais do estado de Santa Catarina.

- Avaliar a qualidade da informação dos Sistemas de Informação sobre Nascidos Vivos e Mortalidade do Ministério da Saúde para análise da fecundidade e mortalidade de Santa Catarina.

- Se familiarizar com os bancos de dados de nascidos vivos e óbitos do Ministério da Saúde.

# Desenvolvimento

## Questão 1: Diagrama de Lexis {-}

**a) Construir o Diagrama de Lexis para os dados de nascidos vivos de 2000 a 2021 da UF escolhida (SINASC) e de óbitos menores de 5 anos (idades simples) para o mesmo período segundo ano de nascimento.**

```{r}
nascimentos_jes <- read_csv2("Bases/Nascidos_vivos_SINASC_tabela.csv", 
                         locale=locale(encoding="latin1"))

names(nascimentos_jes)<- c("Ano_nascimento","Nascimentos")

```

```{r}
obitos$ano_nasc <- str_sub(obitos$DTNASC,5,8) #obter a parte de uma string; pegar do quinto ao oitavo caractere
obitos$ano_obt <- str_sub(obitos$DTOBITO, 5,8)

tabela <- obitos %>% mutate(idade_arrumada = case_when(str_sub(IDADE,1,1)<4 ~ 0,
                                                     str_sub(IDADE,1,1)==4 ~ 0+as.numeric(str_sub(IDADE,2)),
                                                     str_sub(IDADE,1,1)==5 ~ 100+as.numeric(str_sub(IDADE,2)))) %>%
  mutate(idade_certa = floor(as.numeric(difftime(dmy(DTOBITO), dmy(DTNASC), units = "days")/365))) %>%
  select(ano_nasc, ano_obt, idade_certa, IDADE) %>% #apenas as variaveis q vao para a tabela
  filter(idade_certa < 5) %>% #obitos menores de 5 anos
  group_by(ano_nasc, ano_obt, idade_certa) %>% #faz sentido agrupar pq ha mtos dados em comum
  mutate(n = n()) %>% #cria nova variavel de contagem
  ungroup() %>%
  distinct(idade_certa, ano_nasc, ano_obt, .keep_all = T) %>%
  arrange(ano_obt, desc(ano_nasc), idade_certa) %>%
  mutate(TRI = case_when(as.numeric(ano_obt) - as.numeric(ano_nasc) == as.numeric(idade_certa) ~ 0,
                         as.numeric(ano_obt) - as.numeric(ano_nasc) != as.numeric(idade_certa) ~1))

# Plotando diagrama de Lexis

# diagrama <- lexis_grid(lwd=0.15, year_start = 1995, year_end = 2023, age_start = -1, age_end = 5) + 
#   annotate(geom="text", x=as.Date(paste0(tabela$ano_obt[tabela$TRI==1]
#                                          ,"-05-07"))
#            ,y=tabela$idade_certa[tabela$TRI==1]+0.75,
#            label=c(tabela$n[tabela$TRI==1]), size = 2,
#            color="black", fontface = "bold") +
#   annotate(geom = "text", x= as.Date(paste0(nascimentos_jes$Ano_nascimento,"-07-01")),
#            y= -0.2,
#            label=nascimentos_jes$Nascimentos,size = 1.6 ,color = "darkred", fontface = "bold") +
#   annotate(geom="text", x=as.Date(paste0(tabela$ano_obt[tabela$TRI==0]
#                                          ,"-10-01"))
#            ,y=tabela$idade_certa[tabela$TRI==0]+0.4,
#            label=c(tabela$n[tabela$TRI==0]), size = 2,
#            color="black", fontface = "bold") +
#   labs(
#        x = "Ano",
#        y = "Idade") +
#   theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1))
# 
# diagrama
# ggsave("diaglexis_a.png", width = 188, height = 93, units = "mm")
```

O Diagrama de Lexis apresentado a seguir auxilia a localizar visualmente os nascimentos vivos e óbitos menores de 5 anos ocorridos entre os anos de 2000 e 2021 no estado de Santa Catarina. 

\begin{figure}[h!]
	\centering
	\caption{Diagrama de Lexis dos óbitos e nascimentos vivos de 2000 a 2021, Santa Catarina.}
		\includegraphics[scale = .9]{img/diaglexis_a.png}
	\label{fig:lexis}
\end{figure}

Os valores destacados em vermelho indicam o total de nascimentos em cada ano observado, enquanto a visão longitudinal acompanha os grupos de indivíduos ao longo do tempo, com nascimentos e óbitos a cada faixa etária. Observa-se, no geral, que a quantidade de óbitos diminui não somente ao longo dos anos, mas também a medida em que as crianças envelhecem. 

\newpage
**b) Supondo população fechada (inexistência de migração), calcule a probabilidade de um recém-nascido na UF ou território de escolha sobreviver à idade exata 5 para as coortes de 2000 a 2016.**

```{r}
obt_coorte <- tabela %>% 
  filter(TRI==0 & ano_nasc %in% c(2000,2001,2002,2003,2004,
                                  2005,2006,2007,2008,2009,
                                  2010,2011,2012,2013,2014,
                                  2015,2016))
# npx = 1-nqx
# nqx = ndx/lo

obt_coorte$ano_nasc <- as.numeric(obt_coorte$ano_nasc)

ndx <- obt_coorte %>% 
  select(ano_nasc,n) %>% 
  group_by(ano_nasc) %>% 
  summarise(sum(n)) #numeradores de nqx

lo <- nascimentos_jes %>% 
  filter(Ano_nascimento %in% c(2000,2001,2002,2003,2004,
                               2005,2006,2007,2008,2009,
                               2010,2011,2012,2013,2014,
                               2015,2016))
nqx <- (ndx$`sum(n)`)/lo
npx <- 1-nqx
```

```{r}

titulo <-"Probabilidade de sobrevivência de um recém-nascido à idade exata 5 para as coortes de 2000 a 2016 em Santa Catarina"

cbind(lo=lo$Ano_nascimento, Nasc=npx$Nascimentos) %>% 
  as_tibble() %>% 
  mutate( Nasc=comma( Nasc, big.mark = ".",
                           decimal.mark = ",", accuracy = 0.001)) %>% 
  kable(format="latex", caption=titulo, booktabs = T, linesep="", align=c("c","c"),col.names=c("Ano","Probabilidade")) %>% 
  kable_styling(latex_options = "hold_position",position="center")
  
```
\newpage
**c) Considerando o mesmo pressuposto, calcule a probabilidade de sobreviver ao primeiro aniversário dos recém-nascidos no período de 2000 a 2020.**

```{r}
obt_coorte <- tabela %>% 
  filter(TRI==0 & ano_nasc %in% c(2000,2001,2002,2003,2004,
                                  2005,2006,2007,2008,2009,
                                  2010,2011,2012,2013,2014,
                                  2015,2016,2017,2018,2019,
                                  2020))

obt_coorte$ano_nasc <- as.numeric(obt_coorte$ano_nasc)

lo <- nascimentos_jes %>% 
  filter(Ano_nascimento %in% c(2000,2001,2002,2003,2004,
                               2005,2006,2007,2008,2009,
                               2010,2011,2012,2013,2014,
                               2015,2016,2017,2018,2019,
                               2020))

ndx0 <- obt_coorte %>% 
  filter(idade_certa == 0) %>% 
  select(ano_nasc,n) %>% 
  group_by(ano_nasc) %>% 
  summarise(sum(n)) #numeradores de nqx


nqx0 <- ndx0/lo
npx0 <- 1-nqx0


titulo2 <-"Probabilidade de sobrevivência ao primeiro aniversário dos recém-nascidos em Santa Catarina no período de 2000 a 2020"

data.frame(lo=lo$Ano_nascimento, prob=npx0$`sum(n)`) %>% 
  mutate( prob=comma( prob,big.mark = ".", decimal.mark = ",", accuracy = 0.001)) %>% 
  kable(format="latex", caption=titulo2, booktabs = T, digits=4, linesep="", align=c("c","c"),col.names=c("Ano","Probabilidade")) %>% 
  kable_styling(latex_options = "hold_position",position="center")
```

**d) Comente sobre os valores encontrados. Não esquecer a qualidade da informação trabalhada.**

Supondo população fechada (inexistência de migração), a probabilidade de um recém-nascido em Santa Catarina sobreviver à idade exata de 5 anos para as gerações de 2000 a 2016 está em torno de 98$\%$ para todas as coortes. Resultado próximo foi observado para a probabilidade de sobreviver ao primeiro aniversário de um recém-nascido no estado, entre os anos de 2000 a 2020. Ocorre que tais resultados estão condicionados a situações como subnotificação de registros, imprecisões durante a coleta dos dados e outras possíveis limitações. 

\newpage

## Questão 2: Natalidade/Fecundidade {-}

**a) Com base nos dados do SINASC para os de 2010, 2019 e  2021 e na população por sexo e idade estimada (projetada), construa os seguintes indicadores para a Unidade da Federação:**



### Taxa Bruta de Natalidade (TBN) {-}

```{r}


# Processamento dados -----


pop_grupos<- populacao %>% 
  select(IDADE, Sexo, "2010","2019", "2021" ) %>% 
  mutate(IDADE=str_replace(IDADE, "\\+", "")) %>% 
  mutate(IDADE=as.numeric(IDADE)) %>% 
  mutate(faixa=cut(IDADE, breaks=c(-1, 1, 5, 10, 15, 20,
                                   25, 30, 35, 40, 45, 50, 
                                   55, 60, 65, 70, 75, 80, 
                                   85,90,  200), 
                   labels=c("<1", "1-4", "5-9", "10-14", "15-19",
                            "20-24", "25-29", "30-34", "35-39", 
                            "40-44", "45-49", "50-54", "55-59",
                            "60-64", "65-69", "70-74", "75-79", 
                            "80-84", "85-89", ">90"), right=F)) %>% 
  pivot_longer(cols=c("2010", "2019", "2021"), names_to = "Ano", 
               values_to = "Pop") %>% 
  group_by(Ano, Sexo, faixa) %>% 
  summarise(Pop=sum(Pop)) %>% 
  pivot_wider(id_cols=c(Sexo, faixa), 
              names_from = Ano, values_from = Pop) 


# chequei só tem SC mesmo

nascimentos_trat <- nascimentos %>% 
  select(IDADEMAE, DTNASC, SEXO, DTNASCMAE) %>% 
  mutate(DTNASC=dmy(DTNASC),
         DTNASCMAE=dmy(DTNASCMAE),
         IDADEMAE=as.numeric(IDADEMAE)) %>% 
  mutate(Ano=as.character(year(DTNASC)),
         faixa=cut(IDADEMAE, breaks=c(-1, 1, 5, 10, 15, 20,
                                          25, 30, 35, 40, 45, 50, 
                                          55, 60, 65, 70, 75, 80, 
                                          85,90,  200), 
                   labels=c("<1", "1-4", "5-9", "10-14", "15-19",
                                   "20-24", "25-29", "30-34", "35-39", 
                                   "40-44", "45-49", "50-54", "55-59",
                                   "60-64", "65-69", "70-74", "75-79", 
                                   "80-84", "85-89", ">90"), right=F))
  
nascimentos_tot <- nascimentos_trat %>% 
  group_by(Ano) %>% 
  count(name="nasc")

TBN <-pop_grupos %>% 
  adorn_totals() %>% 
  filter(Sexo=="Total")%>% 
  select("2010", "2019", "2021") %>% 
  pivot_longer(everything(), names_to = "Ano",
               values_to = "Pop") %>% 
  left_join(nascimentos_tot) %>% 
  mutate(TBN = (nasc/Pop)*1000)


```

A TBN é uma medida da intensidade dos nacimentos em uma população. É uma das medidas mais simples de serem realizadas no que se refere a medida de nascimentos de uma população, uma vez que para seu cálculo são necessários apensas os valores de população residente e de nascimentos ocorridos em um período. É uma medida que pode ser muito influenciada pela estrutura etária de uma população bem como a razão de sexo. 

Pela tabela abaixo, podemos observar que a TBN do estado se manteve em torno de 13 nascimentos para cada mil habitantes, sendo que a taxa mais baixa foi observada em 2021. 

```{r}

caption1 <- "Taxa Bruta de Natalidade no estado de Santa Catarina, Brasil, nos anos de 2010, 2019 e 2021."

TBN %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>% 
  kable(format="latex",caption = caption1, booktabs = TRUE, linesep="", align=c("c", "r", "r", "r"), col.names=c("Ano", "População\nresidente", "Nascidos\nVivos", "TBN\n(mil hab.)"))  %>%
   kable_styling(latex_options="hold_position", position="center")
```

### Taxa Fecundidade Geral (TFG) {-}

A TFG ligeriamente mais refinada que o indicador anterior por acrescenta uma informação que a medida anterior não possúia, que é a relaÇão de nascimentos por mulheres em período. Entretanto, ainda há muita influência da estrutura etária, uma vez que a fecundidade feminina não é constante durante seu período fértil. 
Ta tabela abaixo podemos observar os resultados para os anos selecionados. Nesse caso o valor mais baixo foi observado em 2010 e o mais alto em 2019, e em 2021 o valor voltou a descrescer. 

```{r}
pop_fem_fertil <- pop_grupos %>% 
  filter(Sexo=="F", 
         faixa %in% c("15-19", "20-24", "25-29",
                      "30-34", "35-39", "40-44",
                      "45-49")) 

TFG <- pop_fem_fertil %>% 
  adorn_totals() %>% 
  filter(Sexo=="Total") %>% 
  select("2010", "2019", "2021") %>% 
  pivot_longer(everything(), names_to = "Ano",
               values_to = "Pop_fem") %>% 
  left_join(nascimentos_tot) %>% 
  mutate(TFG = nasc/Pop_fem*1000)

caption2 <- "Taxa de Fecundidade Geral por mil habitantes no estado de Santa Catarina, Brasil, nos anos de 2010, 2019 e 2021."

TFG %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>% 
  kable(format="latex",caption = caption2, booktabs = TRUE, linesep="", align=c("c", "r", "r", "r"), col.names=c("Ano", "População Feminina \nresidente", "Nascidos\nVivos", "TGF\n(mil hab.)"))  %>%
   kable_styling(latex_options="hold_position", position="center")
```


### Taxas específicas de fecundidade - nfx {-}


A medida de taxa específica acrescenta ainda a estratificação por faixa-etária. Nesse sentido, é uma medida que permite a comparação etre populações e ao longo do tempo. 

Abaixo podemos observar que para todos os anos, a idade mais prolífica foi entre 25-29 anos. Entretanto, observamos que para o ano de 2010 a fecundidade era mais equilibrada entre 20-24 e 25-29 anos, enquanto que para o ano de 2019 e 2022 houve relativamente taxas maiores em idades de 25-29 > 30 anos. 


```{r}
pop_fem_fertil_faixa <- pop_fem_fertil %>% 
  pivot_longer(c("2010", "2019", "2021"),
               names_to = "Ano", values_to = "Pop") 
 
nfx <- nascimentos_trat %>% 
  group_by(Ano, faixa) %>% 
  count(name = "nasc") %>% 
  right_join(pop_fem_fertil_faixa) %>% 
  mutate(nfx = nasc/Pop*1000) %>% 
  select(Ano, faixa, nfx) %>% 
  pivot_wider(id_cols = faixa, 
              names_from = Ano, 
              values_from = nfx) 


caption3 <- "Taxa de Fecundidade Específica por mil habitante no estado de Santa Catarina, Brasil, nos anos de 2010, 2019 e 2021."

nfx %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".", accuracy = .01)) %>%
  mutate(faixa=str_c(faixa,  " anos")) %>% 
  kable(format="latex",caption = caption3, booktabs = TRUE, linesep="", align=c("l", "r", "r", "r"), col.names=c("Faixa-Etária", "2010", "2019", "2021"))  %>%
   kable_styling(latex_options="hold_position", position="center") %>% 
  add_header_above(c(" ", "nfx (mil hab.)"=3))

```


Abaixo podemos observar o gráfico dessa dinâmica. No ano de 2010 foi mais comum a ocorrência de mães adolescentes. Nos anos de 2019 e 2021 houve um aumento na reprodução no estado, com aumento nos nascimentos para todas as outras faixas-estárias maternas. 

```{r}
fig1 <- nfx %>% 
  pivot_longer(-faixa, names_to = "Ano", values_to = "nfx") %>% 
  #mutate(faixa=as.numeric(str_sub(faixa, 1, 2))) %>% 
  ggplot(aes(x=factor(faixa), color=Ano, group=Ano))+
  geom_path(aes(y=nfx),)+
  geom_point(aes(y=nfx))+
  theme_classic()+
  theme(axis.text.x = element_text(angle=45, hjust=1))+
  labs(x="Faixa-Etária", y= "Taxa Específica de Fecundidade (mil hab.)")

ggsave(fig1, filename = "img/fig_nfx.png")

```

\begin{figure}[H]
	\centering
		\caption{Taxa de Fecundidade específica para os anos de 2010, 2019, 2021, Santa Catarina.}
		\includegraphics[scale = 1]{img/fig_nfx.png}
	\label{fig:fig1}
\end{figure}

### Taxa de Fecundidade Total {-}

A taxa de fecundidade total pode trazer informação sobre o potencial de crescimento de uma população. Em geral, valores acima de 2,1 indicam uma reposição positiva da população, com tendência de crescimento a longo prazo. Notamos que, pelo padrão abaixo, apesar de ter havido um aumento na reprodução nos últimos anos, esse valor se mantém abaixo do limiar considerado para reposição da população existente.

```{r}
TFT <- nfx %>% 
  pivot_longer(c("2010", "2019", "2021"),
               names_to = "Ano", values_to = "nfx") %>% 
  mutate(nfx_5=5*nfx/1000) %>% 
  select(-nfx) %>% 
  pivot_wider(id_cols = faixa, 
              names_from = Ano, 
              values_from = nfx_5) %>% 
  adorn_totals(name="TFT") %>% 
  filter(faixa=="TFT") %>% 
  pivot_longer(-faixa, names_to =  "Ano", values_to = "TFT") %>% 
  select(-faixa)

caption4 <- "Taxa de Fecundidade total no estado de Santa Catarina, Brasil, nos anos de 2010, 2019 e 2021."

TFT %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".", accuracy = .01)) %>%
  kable(format="latex",caption = caption4, booktabs = TRUE, linesep="", align=c("l", "r"), col.names=c("Ano", "TFT"))  %>%
   kable_styling(latex_options="hold_position", position="center") 
```


### Taxas específicas de fecundidade feminina {-}

As taxas específicas de fecundidade feminina já acrescentam a informação de reposição da população com indivíduos que, por sua vez, també, tâm a capacidade de se reproduzir. A estratificação por faixa-etária permite a comparação entre populações e ao longo do tempo, e também o cálculo do indicador que será apresentado no próximo tópico. 



```{r}
nffx <- nascimentos_trat %>% 
  filter(SEXO==2) %>% 
  group_by(Ano, faixa) %>% 
  count(name = "nasc") %>% 
  right_join(pop_fem_fertil_faixa) %>% 
  mutate(nffx = nasc/Pop*1000) %>% 
  select(Ano, faixa, nffx) %>% 
  pivot_wider(id_cols = faixa, 
              names_from = Ano, 
              values_from = nffx) 


caption5 <- "Taxas Específica de Fecundidade Feminina por mil habitante no estado de Santa Catarina, Brasil, nos anos de 2010, 2019 e 2021."

nffx %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".", accuracy = .01)) %>%
  mutate(faixa=str_c(faixa,  " anos")) %>% 
  kable(format="latex",caption = caption5, booktabs = TRUE, linesep="", align=c("l", "r", "r", "r"), col.names=c("Faixa-Etária", "2010", "2019", "2021"))  %>%
   kable_styling(latex_options="hold_position", position="center") %>% 
  add_header_above(c(" ", "nffx (mil hab.)"=3))
```


### Taxa Bruta de Reprodução {-}

A taxa bruta de repodução poderia ser equivalente a taxa de fecundidade total, mas dessa vez considerando apenas a populaÇão feminina.

```{r}
TBR <- nffx %>% 
  pivot_longer(c("2010", "2019", "2021"),
               names_to = "Ano", values_to = "nffx") %>% 
  mutate(nffx_5=5*nffx/1000) %>% 
  select(-nffx) %>% 
  pivot_wider(id_cols = faixa, 
              names_from = Ano, 
              values_from = nffx_5) %>% 
  adorn_totals(name="TBR") %>% 
  filter(faixa=="TBR") %>% 
  select(-faixa) %>% 
  pivot_longer(everything(), names_to = "Ano", values_to = "TBR")

caption6 <- "Taxa de Bruta de Reprodução no estado de Santa Catarina, Brasil, nos anos de 2010, 2019 e 2021."

TBR  %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".", accuracy = .01)) %>%
  kable(format="latex",caption = caption6, booktabs = TRUE, linesep="", align=c("l", "r"), col.names=c("Ano", "TBR"))  %>%
   kable_styling(latex_options="hold_position", position="center") 
```


### Taxa Líquida de Reprodução {-}

Finalmente, a taxa líquida de reprodução leva em consideração o risco de mortalidade em cada faixa-etária. 
```{r}




# peguei os valores manualmente da tabua de vida lá de baixo
# não é muito reprodutivel, mas enfim, na hora do apertto...

L2010 <- c(4.941427, 4.935294, 4.922257, 4.905507, 4.884595, 4.859665, 4.805954)
L2019 <- c(4.947250, 4.941111, 4.928058, 4.911288, 4.890351, 4.865393, 4.811618)
L2021 <- c(4.947250, 4.941111, 4.928058, 4.911288, 4.890351, 4.865393, 4.811618)

mortalidade_feminina <- data.frame(Ano=c(rep("2010",7),
                                         rep("2019",7),
                                         rep("2021",7)),
                                   faixa=rep(c("15-19", "20-24", "25-29",
                                               "30-34", "35-39", "40-44",
                                               "45-49"),3),
                                   Lx_lo=c(L2010,L2019,L2021))

  
TLR <- nffx %>% 
  pivot_longer(c("2010", "2019", "2021"),
               names_to = "Ano", values_to = "nffx") %>% 
  left_join(mortalidade_feminina) %>% 
  mutate(nffx_5=Lx_lo*nffx/1000) %>% 
  select(-nffx) %>% 
  pivot_wider(id_cols = faixa, 
              names_from = Ano, 
              values_from = nffx_5) %>% 
  adorn_totals(name="TLR") %>% 
  filter(faixa=="TLR") %>% 
  select(-faixa) %>% 
  pivot_longer(everything(), names_to = "Ano", values_to = "TLR")


caption7 <- "Taxa de Líquida de Reprodução no estado de Santa Catarina, Brasil, nos anos de 2010, 2019 e 2021."

TLR  %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".", accuracy = .01)) %>%
  kable(format="latex",caption = caption6, booktabs = TRUE, linesep="", align=c("l", "r"), col.names=c("Ano", "TLR"))  %>%
   kable_styling(latex_options="hold_position", position="center") 

```

\newpage

**b) Compare os seus resultados com os valores obtidos  pelo IBGE (projeções), e para o Brasil, pelo estudo GBD, pelas Nações Unidas (UN Population) e aqueles publicados no site do Datasus para 2010 (RIPSA - Indicadores e dados básicos - http://tabnet.datasus.gov.br/cgi/idb2012/matriz.htm ). Como  os indicadores de reprodução não aparecem nessas listas, a partir das TFT, calcule esses indicadores para comparação.**

Podemos observar que os valores encontrados nesse trabalho são próximos aos apresentados por outras fontes. Enteranto, observam-se algumas variações. Destacamos a diferença da Taxa Bruta de Natalidade divulgada pela UN para 2010, que foi maior em relação a todos os outros indicadores publicados e em relação a esse trabalho. É esperado que os indicadores nacionais estejam mais próximos a realidade, por estarem mais próximos a fonte original de dados bem como a valores mais atualizados das projeções populacionais para o cálculo desse indicador específico. 


```{r}
# - A taxa Bruta de natalidade segundo a 2010 (RIPSA - Indicadores e dados básicos 
#- http://tabnet.datasus.gov.br/cgi/idb2012/matriz.htm )foi de 13.7 para 2010. 
# # 
# TEF 
#

TBR_comp <- data_frame(Ind="TBN", "RIPSA_2010"=13.7,"IBGE_2010"=NA, "IBGE_2019"=NA,
                       "IBGE_2021"=NA,"UN_2010"= NA,"UN_2021"= NA,
                       GBD_2019=NA, "2010"=13.32, "2019"=13.68,
                       "2021"=13.15)

ibge_indicadores_menor<- ibge_indicadores %>% 
  filter(Ano %in% c( 2010, 2019, 2021))

nfx_IBGE <- ibge_indicadores_menor %>% 
  select(Ano, "15-19":"45-49" ) %>% 
  pivot_longer(-Ano, names_to = "faixa", values_to = "nfx") %>% 
  pivot_wider(id_cols =faixa, names_from = Ano, values_from = nfx) %>% 
  rename(IBGE_2019=`2019`,
         IBGE_2010=`2010`,
         IBGE_2021=`2021`) %>% 
  left_join(nfx) %>%
  mutate(`2019`=`2019`/1000,
         `2010`=`2010`/1000,
         `2021`=`2021`/1000) %>% 
  rename(Ind=faixa) 

TBR_nfx_comp <- TBR_comp %>% 
  bind_rows(nfx_IBGE)

TBR_nfx_comp[2:8, 2] <- c(0.05088,	0.07962,	0.08163,	0.06592,	0.03475,	0.00865,	0.00055)

TBR_nfx_comp[2:8,1]<-paste0("nfx ", TBR_nfx_comp[2:8,1]$Ind)

# - segundo RIPSA a taxa específica de fecundidade para 2010
# 	0,05088	0,07962	0,08163	0,06592	0,03475	0,00865	0,00055
# 
# 	
# TFT 


TFT_ibge <- ibge_indicadores_menor %>% 
  select(Ano, TFT) %>% 
  mutate(Ano=as.character(Ano)) %>% 
  rename(TFT_ibge=TFT) %>% 
  left_join(TFT) 

TFT_comp <- data_frame(Ind="TFT", "RIPSA_2010"=NA,"IBGE_2010"=1.60, "IBGE_2019"=1.74,
                       "IBGE_2021"=1.73,"UN_2010"= NA,"UN_2021"= NA,
                       GBD_2019=NA, "2010"=1.56, "2019"=1.73,
                       "2021"=1.71)

TBR_TFT_nfx_comp <- TFT_comp %>% 
  bind_rows(TBR_nfx_comp)

# - segundo RIPSA a taxa  de fecundidade total para 2010 foi de 1,61

TBR_TFT_nfx_comp[1,2] <- 1.61
# - segundo UN https://data.un.org/en/iso/br.html TFT foi de 1.9 para 2010, 1.8 para 2015, 1.7 para 2021

TBR_TFT_nfx_comp[1,6]<-1.9
TBR_TFT_nfx_comp[1,7]<-1.7

# segundo GDB foi de 1.4 para 2019 https://www.healthdata.org/brazil-santa-catarina
TBR_TFT_nfx_comp[1,8]<-1.4

#TBR 
# rpsa_2010

TBR_ripsa_2010 <- 1.61/2.05 # dado do site
TBR_ibge_2010 <- 1.60/2.05
TBR_ibge_2019 <- 1.74/2.05
TBR_ibge_2021 <- 1.73/2.05
TBR_UN_2010 <- 1.9/2.05
TBR_UN_2021 <- 1.7/2.05
TBR_GDB_2021 <- 1.4/2.05

TBR_comp <- data_frame(Ind="TBR", "RIPSA_2010"=TBR_ripsa_2010,"IBGE_2010"=TBR_ibge_2010, "IBGE_2019"=TBR_ibge_2019,
                       "IBGE_2021"=TBR_ibge_2021,"UN_2010"= TBR_UN_2010,"UN_2021"= TBR_UN_2021,
                       GBD_2019=TBR_GDB_2021, "2010"=0.76, "2019"=0.84,
                       "2021"=0.83) 

TBR_TFT_nfx_comp[2,3:5] <- t(c(13.57, 13.66, 13.24))

TBR_TFT_TBR_nfx_comp <-TBR_TFT_nfx_comp %>% 
  bind_rows(TBR_comp) %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".",
                    accuracy = 0.001))%>% 
  mutate_all(~replace_na(., "-")) %>% 
  mutate(Ind=fct_relevel(Ind,"TBN", "TFT", "TBR", "nfx 15-19",
                         "nfx 20-24", "nfx 25-29", "nfx 30-34", "nfx 35-39", "nfx 40-44", "nfx 45-49")) %>% 
  arrange(Ind)



# c) Comente esses resultados (inclusive os gráficos das nfx), fazendo referência a artigos já publicados sobre o assunto.


TBR_TFT_TBR_nfx_comp %>% 
  kable(format="latex",caption = caption6, booktabs = TRUE, linesep="", align=c("l", rep("r", 10)), col.names=c("Indicador", "2010", "2010", "2019", "2021", "2010", "2021", "2019", "2010", "2019", "2021"))  %>%
   kable_styling(latex_options="hold_position", position="center", full_width = FALSE) %>% 
   add_header_above(c(" ", "RIPSA" = 1, "IBGE" = 3,
                      "UN"=2, "GDB"=1, "Este trabalho"=3))

```

\newpage

Ademais, outras varações encontradas neste trabalho em relação aos indicadores oficiais podem ser provenientes de diferença na qualidade das bases de dados. Neste trabalho utilizou-se as bases abertas do SIM e SINASC e não foi realizado um trabalho de correção de inconsistências e incompletidudes propriamente dito. Um trabalho mais refinado de correções é necessário para registrar indicadores mais realistas. Por exemplo, nese trabalho foram identificados alguns partos de mães com <10 anos de idade e com >80 anos, o que é muito provavelmente um erro de digitação. 


**c) Comente esses resultados (inclusive os gráficos das nfx), fazendo referência a artigos já publicados sobre o assunto.**

Os dados foram comentados em vias gerais a medida que foram apresentados nas questões anteriores. 

**d) Para os dados do SINASC para 2021, análise a associação entre (apresente ao menos uma medida de associação):**

### Idade e escolaridade da mãe {-}

```{r fig}
ass1 <- nascimentos %>% 
  mutate(ano=str_sub(DTNASC, 5,8)) %>% 
  filter(ano=="2021") %>% 
  mutate(idade=as.numeric(IDADEMAE),
         escol=as.double(ESCMAE)) %>% 
  filter(idade<50,
         idade>15,
         !is.na(escol),
         escol!=9) %>% 
  mutate(faixa=cut(idade, breaks=c(0,30, 100 ), 
                   labels=c("<30",  ">30" )),
         ensino_medio=ifelse(escol>=4, "Sim", "Não")) 
  
tab1 <-table(ass1$faixa, ass1$ensino_medio)
chi1 <- comma(chisq.test(tab1)$p.value, decimal.mark = ",", accuracy = 0.01)
odd1 <-comma((as.numeric(tab1[1,1])*as.numeric(tab1[2,2]))/(as.numeric(tab1[2,1])*as.numeric(tab1[1,2])), decimal.mark = ",", accuracy = 0.01) 




mosaico1 <- ggplot(data = ass1) +
  geom_mosaic(aes(x = product(faixa, ensino_medio), fill=faixa), color="black") + 
  scale_fill_manual(values=c("darkcyan",
                                           "darkred"))+
  theme_classic(base_size = 14) +
  labs(x="Possui Ens Méd.", y="Faixa-Etária")+
  theme(legend.position = "none")

ggsave(mosaico1, filename = "img/mosaico1.png")
```

Para permitir uma análise mais direta, a variável de idade foi dicotomizada em mulheres com mais ou menos de 30 anos. Já a variável de escolaridade foi dicotomizada em mulheres que possuem ou não ao menos o Ensino Médio. Observações com valores faltantes foram excluídas. nesse caso, notamos que a proporção de mulheres com ensino médio é a mesma independente da idade ( \~70%). O teste de $\chi^2$ apresentou um p-valor de `r chi1`, indicando que não há evidência de associação. O *Odds Ratio* dessa relação é de `r odd1`, indicando que as chances nos dois grupos é muito próxima. Abaixo podemos ver essa relação graficamente.

\begin{figure}[H]
	\centering
		\caption{Associação entre duas classes de Faixa-Etária e o fato de ter cursado ou não ao menos o Ensino Médio para mães no ano de 2021 em Santa Catarina.}
		\includegraphics[scale = 0.8]{img/mosaico1.png}
	\label{fig:mosaico1}
\end{figure}

### Tipo de parto e Escolaridade da mãe {-}
```{r}
ass2 <- nascimentos %>% 
  mutate(ano=str_sub(DTNASC, 5,8)) %>% 
  filter(ano=="2021") %>% 
  mutate(parto=as.numeric(PARTO),
         escol=as.numeric(ESCMAE)) %>% 
  filter(!is.na(escol),
         escol!=9) %>% 
  filter(!is.na(parto),
         parto!=9) %>% 
  mutate(EM = ifelse(escol>=4, "sim", "não"),
         tipo = ifelse(parto==1, "Natural", "Cesárea")) 


tab2 <-table(ass2$EM, ass2$tipo)
chi2<-comma(chisq.test(tab2)$p.value, decimal.mark = ",",
            accuracy = 0.001)

odd2 <-(as.numeric(tab2[1,1])*as.numeric(tab2[2,2]))/(as.numeric(tab2[2,1])*as.numeric(tab2[1,2]))
odd2 <- comma(1/odd2, decimal.mark = ",", accuracy = 0.01)

mosaico2 <- ggplot(data = ass2) +
  geom_mosaic(aes(x = product(EM, tipo), fill=EM),
              color="black") + 
  scale_fill_manual(values=c("darkcyan",
                                           "darkred"))+
  theme_classic(base_size = 14) +
  labs(x="Parto", y="Possui Ens. Méd.")+
  theme(legend.position = "none")

ggsave(mosaico2, filename = "img/mosaico2.png")
```

A variável de idade foi dicotomizada da mesma forma descrita anteriormente. Nesse caso, notamos que no grupo parto Natural, a proporção de mulherem sem Ensino Médio é maior. Provavelmente as mulheres sem Ensino Médio são também as mulheres que mais utilizam o serviço púplico de saúde, onde a frequência de partos naturais é maior.    O teste de $\chi^2$ apresentou um p-valor <0,001, indicando que há evidência de associação entre essas variáveis. O *Odds Ratio* dessa relação é de `r odd2`, indicando que as chances de ocorrer um parto Natural no grupo de muilheres sem Ensino Médio é 1,8 vezes maior.  


\begin{figure}[H]
	\centering
		\caption{Associação entre o tipo de parto e o fato de ter cursado ou não ao menos o Ensino Médio para mães no ano de 2021 em Santa Catarina.}
		\includegraphics[scale = 0.8]{img/mosaico2.png}
	\label{fig:mosaico2}
\end{figure}


\newpage

## Questão 3: Mortalidade {-}

**a) Com base nos dados sobre óbitos do SIM para 2010, 2019 e 2021 e a população por sexo e idade estimada (projetada) para a UF, obtenha os seguintes indicadores:**

### Taxa Bruta de Mortalidade {-}

```{r}
# Dados -------

#populacao <- read_excel("Bases/populacao_Sc.xls")
#mortalidade <- readRDS("dados_SIM.rds")
#passei la pra cima pois ia precisar

# Letra a -------

# a) Com base nos dados sobre óbitos do SIM para 2010, 2019 e  2021 e a população
# por sexo e idade estimada (projetada) para a UF, obtenha os seguintes indicadores:

mortalidade$ano_obt <- str_sub(mortalidade$DTOBITO, 5,8)
# idade em anos (data obito - data nascimento)
mortalidade$data_obito <- lubridate::dmy(mortalidade$DTOBITO)
mortalidade$data_nasc <- lubridate::dmy(mortalidade$DTNASC)
mortalidade$idade <- (mortalidade$data_obito-mortalidade$data_nasc) #diferenca em dias
mortalidade$idade <- as.numeric((mortalidade$idade)/365)
mortalidade <- mortalidade %>% mutate(sexo = case_when(
  SEXO==1 ~ "M",
  SEXO==2 ~ "F",
  SEXO==9 ~ "Ignorado"
))

mort_anos_filtered <- mortalidade %>% filter(ano_obt %in% c("2010","2019","2021"))

pop_grupos <- populacao %>% 
  select(IDADE, Sexo, "2010","2019", "2021" ) %>% 
  mutate(IDADE=str_replace(IDADE, "\\+", "")) %>% 
  mutate(IDADE=as.numeric(IDADE)) %>% 
  mutate(faixa=cut(IDADE, breaks=c(-1, 1, 5, 10, 15, 20,
                                   25, 30, 35, 40, 45, 50, 
                                   55, 60, 65, 70, 75, 80, 
                                   85,90,  200), 
                   labels=c("<1", "1-4", "5-9", "10-14", "15-19",
                            "20-24", "25-29", "30-34", "35-39", 
                            "40-44", "45-49", "50-54", "55-59",
                            "60-64", "65-69", "70-74", "75-79", 
                            "80-84", "85-89", ">90"), right=F)) %>% 
  pivot_longer(cols=c("2010", "2019", "2021"), names_to = "Ano", 
               values_to = "Pop") %>% 
  group_by(Ano, Sexo, faixa) %>% 
  summarise(Pop=sum(Pop)) %>% 
  pivot_wider(id_cols=c(Sexo, faixa), 
              names_from = Ano, values_from = Pop) 


obitos_trat <- mort_anos_filtered %>% 
  select(data_obito, data_nasc, idade, ano_obt,sexo) %>% 
  mutate(faixa=cut(idade, breaks=c(-1, 1, 5, 10, 15, 20,
                                      25, 30, 35, 40, 45, 50, 
                                      55, 60, 65, 70, 75, 80, 
                                      85, 90,  200), 
                   labels=c("<1", "1-4", "5-9", "10-14", "15-19",
                            "20-24", "25-29", "30-34", "35-39", 
                            "40-44", "45-49", "50-54", "55-59",
                            "60-64", "65-69", "70-74", "75-79", 
                            "80-84", "85-89", ">90"), right=F))

  
## Taxa Bruta de Mortalidade (TBM) ----

obitos_tot <- obitos_trat %>% 
  group_by(ano_obt) %>% 
  count(name="obitos")
names(obitos_tot)[1] <- "Ano"

TBM <- pop_grupos %>% 
  adorn_totals() %>% 
  filter(Sexo=="Total") %>% 
  select("2010", "2019", "2021") %>% 
  pivot_longer(everything(), names_to = "Ano",
               values_to = "Pop") %>% 
  left_join(obitos_tot) %>% 
  mutate(TBM = obitos/Pop*1000)

TBM %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
  kable(format="latex",caption = "Taxas brutas de mortalidade por mil habitantes no estado de Santa Catarina, Brasil, nos anos
de 2010, 2019 e 2021.", booktabs = TRUE,
        linesep="", digits=2, align=c("r", "r", "r", "r"), col.names=c("Ano", "População", "Óbitos", "TBM (mil hab.)"))  %>%
   kable_styling(latex_options="hold_position", position="center")
```

As taxas brutas de mortalidade do estado de Santa Catarina apresentam resultados satisfatórios para os anos de 2010 e 2019. Em 2010, por exemplo, o valor estava abaixo da TBM nacional de 6,03 (IBGE, Projeção da População do Brasil - 2013). O aumento da taxa em 2019 deve-se, provavelmente, ao envelhecimento da população, fato que vem se consolidando de modo geral no país. Portanto, é importante destacar que as taxas brutas não levam em consideração a estrutura etária da população e, consequentemente, não devem ser comparadas no tempo ou entre regiões sem as devidas padronizações.

Por fim, o aumento abrupto da TBM em 2021 chama bastante atenção. Além das mudanças na estrutura etária da população, a pandemia de COVID-19 é fator primordial na explicação desse fenômeno, impactando fortemente toda a estrutura e níveis da mortalidade brasileira. Segundo \citeonline{holzbach} houve um excesso de 6.315 óbitos em 2020 e 17.391 em 2021 em Santa Catarina, esses valores foram calculados comparando mortalidade observada e esperada segundo média das mortes ocorridas entre 2015 e 2019. Além disso, identificou-se que os períodos de maior excesso de mortalidade são exatamente os com mais mortes por COVID-19, o que ajuda a entender a TBM aqui encontrada.

### Taxas específicas de mortalidade por sexo e idade - nMx {-}

```{r}
## Taxas específicas de mortalidade por sexo e idade - nMx (grafique) ----

obitos_tot_idade_sexo <- obitos_trat %>% 
  filter(sexo %in% c("M","F")) %>%
  group_by(ano_obt,faixa,sexo) %>% 
  count(name="obitos")
names(obitos_tot_idade_sexo)[1] <- "Ano"

pop_desagrup <- melt(pop_grupos, c("Sexo","faixa"), value.name="populacao")
names(pop_desagrup)[3] <- "Ano"
names(pop_desagrup)[1] <- "sexo"

nMx <- obitos_tot_idade_sexo %>% 
  left_join(pop_desagrup,by=c("Ano","faixa","sexo")) %>% 
  mutate(nMx = obitos/populacao) %>% 
  filter(!is.na(faixa))

nMx$sexo <- factor(nMx$sexo, levels = c("M","F"),labels=c("Masculino","Feminino"))

plot2010 <- nMx %>% filter(Ano=="2010") %>%
ggplot(aes(x=faixa,y=nMx,group=sexo,colour=sexo))+
geom_line(size=1)+
  scale_y_log10()+
scale_colour_manual(name="Sexo",values=c("darkcyan",
"darkred"))+
labs(x="",y="nMx",title="2010")+
theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1))+
  theme(legend.position = 'top', legend.direction = "horizontal")

plot2019 <- nMx %>% filter(Ano=="2019") %>%
  ggplot(aes(x=faixa,y=nMx,group=sexo,colour=sexo))+
  geom_line(size=1)+
  scale_y_log10()+
  scale_colour_manual(name="Sexo",values=c("darkcyan",
                                           "darkred"))+
  labs(x="",y="nMx",title="2019")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1))+
  theme(legend.position = 'top', legend.direction = "horizontal")

plot2021 <- nMx %>% filter(Ano=="2021") %>%
  ggplot(aes(x=faixa,y=nMx,group=sexo,colour=sexo))+
  geom_line(size=1)+
  scale_y_log10()+
  scale_colour_manual(name="Sexo",values=c("darkcyan",
                                           "darkred"))+
  labs(x="",y="nMx",title="2021")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1))+
  theme(legend.position = 'top', legend.direction = "horizontal")


#cowplot::plot_grid(plot2010,plot2019,plot2021)
#ggsave('./img/TEM.png', width = 188, height = 113, units = 'mm',bg="white")
```

\begin{figure}[H]
	\centering
		\caption{Taxas específicas de mortalidade por sexo e idade em Santa Catarina, Brasil, nos
anos de 2010, 2019 e 2021.}
		\includegraphics[scale = .9]{img/TEM.png}
	\label{fig:nMx}
\end{figure}


```{r}
# tabela nMx

tbl_nMx <- data.frame("faixa"=unique(nMx$faixa),"F2010"=nMx$nMx[(nMx$sexo=="Feminino" & nMx$Ano=="2010")]*1000,
                      "F2019"=nMx$nMx[(nMx$sexo=="Feminino" & nMx$Ano=="2019")]*1000,
                      "F2021"=nMx$nMx[(nMx$sexo=="Feminino" & nMx$Ano=="2021")]*1000,
                      "M2010"=nMx$nMx[(nMx$sexo=="Masculino" & nMx$Ano=="2010")]*1000,
                      "M2019"=nMx$nMx[(nMx$sexo=="Masculino" & nMx$Ano=="2019")]*1000,
                      "M2021"=nMx$nMx[(nMx$sexo=="Masculino" & nMx$Ano=="2021")]*1000
                      )

tbl_nMx$faixa <- str_c(tbl_nMx$faixa,  " anos")
tbl_nMx$faixa[1] <- "$<$ 1 anos"
tbl_nMx$faixa[20] <- "$>$ 90 anos"

captionNMX <- "Taxas específicas de mortalidade por mil habitantes no estado de Santa Catarina, Brasil, nos anos
de 2010, 2019 e 2021."

tbl_nMx %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
  kable(escape = F,format="latex",caption = captionNMX, booktabs = TRUE, linesep="", digits=2,
        align=c("l", "r", "r", "r", "r", "r", "r"), col.names=c("Faixa-Etária", "2010", "2019", "2021", "2010", "2019", "2021"))  %>%
   kable_styling(latex_options="HOLD_position", position="center") %>% 
  add_header_above(c(" ", "nMx feminina" = 3, "nMx masculina" = 3))

```


É possível notar que para todos os anos as curvas seguem uma forma semelhante. Essa forma indica que a mortalidade infantil (menores de 1 ano) é maior que a mortalidade no restante da infância e juventude. Isso deve-se às vulnerabilidades intrínsicas aos menores de 1 ano, por vezes agravadas por fatores como qualidade (ou ausência) do serviço de água e esgotamento sanitário. Ademais, conforme a idade avança aumenta também a taxa de mortalidade.

Outro ponto que se destaca é a diferença por sexo. De modo geral, os homens possuem maiores taxas de mortalidade, para todos os anos e faixas etárias, com exceção da faixa de 5 a 9 anos em 2019. Especialmente, entre 15 e 30 anos, a diferença entre homens e mulheres é acentuado. O motivo desse maior risco na população masculina ainda é incerto e muitas vezes especulativo, como é discutivo em \citeonline{nathanson1984sex}, entretanto, alguns pontos que ajudam a explicar essa diferença são os papéis de gênero e a estrutura social. Além disso, os homens parecem ter uma desvantagem na mortalidade por doenças cardiovasculares e neoplasias em comparação com as mulheres, por fim, hábitos pessoais de saúde parecem afetar mortalidade masculina mais que feminina \cite{nathanson1984sex}.


\newpage
**b) Calcule a TMI, utilizando o número médio de óbitos ocorridos entre 2019 e 2021 e o número de nascimentos de 2020. Calcule os indicadores: taxa de mortalidade neonatal, neonatal precoce, neonatal tardia, posneonatal. Agregando a informação sobre óbitos fetais para os mesmos anos, calcule a taxa de mortalidade perinatal.**

Os diferentes componentes da mortalidade infantil e mortalidade perinatal estão apresentados a seguir.

```{r}
# Letra b -------
nasc_2020 <- 97916 # vem dos arquivos do SINASC
mortalidade$idade_dias <- mortalidade$idade*365

## TMI (óbitos em menores de 1 ano)

# nº medio de obitos de menores de 1 ano

obitos_1_ano <- mortalidade %>% filter(ano_obt %in% c("2019","2020","2021")) %>%
  filter(idade_dias<365) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_1_ano <- mean(obitos_1_ano$obitos)

q10 <- media_obt_1_ano/nasc_2020*1000

## Mortalidade Neonatal (Risco de um recém-nascido morrer antes de 28 dias de vida)

obitos_neonatal <- mortalidade %>% filter(ano_obt %in% c("2019","2020","2021")) %>%
  filter(idade_dias<28) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_neonatal <- mean(obitos_neonatal$obitos)

Mneonatal <- media_obt_neonatal/nasc_2020*1000

## Mortalidade Posneonatal (Risco de um recém-nascido morrer entre 28 e 364 dias de vida)

obitos_posneonatal <- mortalidade %>% filter(ano_obt %in% c("2019","2020","2021")) %>%
  filter(idade_dias>=28 & idade_dias<365) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_posneonatal <- mean(obitos_posneonatal$obitos)

Mposneonatal <- media_obt_posneonatal/nasc_2020*1000

## Mortalidade Precoce (Risco de um recém-nascido morrer antes de 7 dias de vida)

obitos_precoce <- mortalidade %>% filter(ano_obt %in% c("2019","2020","2021")) %>%
  filter(idade_dias<7) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_precoce <- mean(obitos_precoce$obitos)

Mprecoce <- media_obt_precoce/nasc_2020*1000

## Mortalidade Tardia (Risco de um recém-nascido morrer entre 7 e 27 dias de vida)

obitos_tardia <- mortalidade %>% filter(ano_obt %in% c("2019","2020","2021")) %>%
  filter(idade_dias>=7 & idade_dias<27) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_tardia <- mean(obitos_tardia$obitos)

Mtardia <- media_obt_tardia/nasc_2020*1000


## Taxa de Mortalidade Perinatal

obitos_fetais <- data.frame("Ano"= 2019:2021,"Obt_fetal" = c(810,765,771)) #consultado no TabNet SIM
media_obt_fetal <- mean(obitos_fetais$Obt_fetal)

TMPerinatal <- (media_obt_precoce+media_obt_fetal)/(nasc_2020+media_obt_fetal)*1000

# tabela mortalidade infantis
tipos <- c("Infantil","Neonatal","Posneonatal","Neonatal precoce","Neonatal tardia","Perinatal")
tbl_mort_infantil <- data.frame("Taxa de mortalidade"=tipos,
                                "Valor (mil hab.)"=c(q10,Mneonatal,Mposneonatal,
                                                     Mprecoce,Mtardia,TMPerinatal),
                                check.names = F)

tbl_mort_infantil %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
  kable(format="latex",caption = "Componentes da mortalidade infantil por mil habitantes no estado de Santa Catarina, Brasil, utilizando o número médio de óbitos entre 2019 e 2021 e o número de nascimentos de 2020.", booktabs = TRUE, linesep="", digits=2,
        align=c("l", "r"),label="tabinf")  %>%
   kable_styling(latex_options="HOLD_position", position="center")
```

Destaca-se a mortalidade infantil de 9,29, ou seja, a cada mil nascidos vivos no período em média ocorrem 9,29 óbitos em menores de 1 ano em Santa Catarina. Esse valor leva em conta óbitos de 2019 a 2021. De acordo com \citeonline{boletimepidem}, em 2019 a TMI para o Brasil era de 13,3, enquanto em Santa Catarina era de 9,6. Esses valores e os apresentados neste trabalho indicam que o estado de Santa Catarina tem um cenário melhor se comparado com a média nacional.

Entretanto, vale ressaltar que de acordo com a meta dos Objetivos de Desenvolvimento Sustentável da ONU, o Brasil precisa, até 2030, reduzir a taxa da mortalidade infantil para no máximo 5 por mil nascidos vivos. Ou seja, ainda há um longo caminho a ser seguido no sentido de diminuição dos óbitos nessa população, e para o estado escolhido neste trabalho essa afirmação também é válida.


\newpage

**c) Compare os seus resultados com os valores obtidos pelo estudo GBD, pela Nações Unidas (UN Population) e aqueles publicados no site do Datasus (RIPSA - Indicadores e dados básicos - http://tabnet.datasus.gov.br/cgi/idb2012/matriz.htm ). Para a TMI, compare com os valores obtidos na questão 1. Comente sobre os aspectos metodológicos dessas duas formas de cálculo.**

Tendo como comparativo o método apresentado para a taxa de mortalidade infantil, junto ao fator que calcula a probabilidade de sobrevivência do nascido até o mesmo completar um ano de vida na questão 1, observa-se que o segundo indicador trabalha com valores absolutos, apresentados diretamente, entretanto a taxa de mortalidade infantil foi calculada pela média dos óbitos centralizado em 2020, com o objetivo de diminuir o impacto de um ano que possa ter um comportamento fora do normal, seja por acontecimentos naturais ou algum problema de coleta. Para as taxas calculadas pela pesquisa relacionada à mortalidade de menores de 1 ano do RIPSA, os dados apresentam queda com o decorrer dos anos.

Embora possa se observar essa tendência, temos que as taxas obtidas a partir dos dados do SIM e do SINASC são menores que as apresentadas na última pesquisa do RIPSA. Mesmo que a diferença apresentada seja baixa, nunca maior do que 1 ponto percentual, um fator explicativo pode ser a diferença entre datas, já que as taxas obtidas no item b são de 2021 e a última taxa calculada pelo RIPSA é de 2011.

\newpage
**d) Compare a estrutura de mortalidade por causas entre 2010 e 2021. Utilize 20 primeiras grupos de causas segundo Grupos CID-10 (ver Tabnet - Datasus), segundo sexo para os anos selecionado. Comente os resultados. Destacar a mortalidade por Covid-19 (CID B34.2).**


```{r}
# Letra d -------
obts_causas <- mortalidade %>% filter(ano_obt %in% c("2010","2021")) %>%
  select(CAUSABAS,ano_obt,sexo) %>%
  filter(sexo %in% c("M","F"))

obts_causas_top_20 <- obts_causas %>% group_by(ano_obt,sexo,CAUSABAS) %>%
  summarise(causas_count = n()) %>% ungroup() %>%
  group_by(ano_obt,sexo) %>%
  arrange(desc(causas_count),.by_group = TRUE) %>%
  slice_head(n=20)

# conferindo oq é cada código da CID

CID <- data.frame("CAUSABAS"=unique(obts_causas_top_20$CAUSABAS),
                  "significado"=c("Infarto agudo do miocárdio não especificado",
                                  "Acidente vascular cerebral, não especificado como hemorrágico ou isquêmico",
                                  "Diabetes mellitus não especificado - sem complicações",
                                  "Pneumonia não especificada",
                                  "Neoplasia maligna da mama, não especificada",
                                  "Hipertensão essencial (primária)",
                                  "Doença pulmonar obstrutiva crônica não especificada",
                                  "Neoplasia maligna dos brônquios ou pulmões, não especificado",
                                  "Outras causas mal definidas e as não especificadas de mortalidade",
                                  "Insuficiência cardíaca congestiva",
                                  "Insuficiência cardíaca não especificada",
                                  "Outras doenças cerebrovasculares especificadas",
                                  "Doença cardíaca hipertensiva com insuficiência cardíaca (congestiva)",
                                  "Doença de Alzheimer não especificada",
                                  "Septicemia não especificada",
                                  "Doença pulmonar obstrutiva crônica com infecção respiratória aguda do trato respiratório inferior",
                                  "Morte sem assistência",
                                  "Neoplasia maligna do estômago, não especificado",
                                  "Infecção do trato urinário de localização não especificada",
                                  "Hemorragia intracerebral não especificada",
                                  "Neoplasia maligna da próstata",
                                  "Neoplasia maligna do esôfago, não especificado",
                                  "Lesão autoprovocada intencionalmente por enforcamento, estrangulamento e sufocação",
                                  "Outras formas de cirrose hepática e as não especificadas",
                                  "Cirrose hepática alcoólica",
                                  "Pessoa traumatizada em um acidente de trânsito com um veículo a motor não especificado",
                                  "Infecção por coronavírus de localização não especificada",
                                  "Pneumonia bacteriana não especificada",
                                  "Sequelas de acidente vascular cerebral não especificado como hemorrágico ou isquêmico"))

obts_causas_top_20 <- left_join(obts_causas_top_20, CID, by="CAUSABAS") 

# tabela para os anos de 2010 e 2021 FEMININO

df_mulheres <- obts_causas_top_20 %>% filter(sexo=="F")

tbl_mulheres <- data.frame("significado"= df_mulheres$significado[1:20],
                           "2010" = df_mulheres$causas_count[1:20],
                           check.names = F) %>%
            left_join(.,df_mulheres[21:40,c("causas_count","significado")],
            by="significado")

names(tbl_mulheres)[3] <- "2021"

tbl_mulheres <- rbind(tbl_mulheres, data.frame(significado=df_mulheres$significado[21],"2010"="-",
                                               "2021"=df_mulheres$causas_count[21],check.names = F))

tbl_mulheres <- rbind(tbl_mulheres, data.frame(significado=df_mulheres$significado[37],"2010"="-",
                                               "2021"=df_mulheres$causas_count[37],check.names = F))

tbl_mulheres$`2021`[is.na(tbl_mulheres$`2021`)] <- "-"
names(tbl_mulheres)[1] <- "Causa básica da DO"

tbl_mulheres %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
  kable(format="latex",caption = "Estrutura de mortalidade por causas de 2010 e 2021 para o sexo feminino.", booktabs = T, linesep="", digits=2,
        align=c('l','r','r'))  %>%
   kable_styling(latex_options=c("HOLD_position","scale_down"), position="center")

```

```{r}
# tabela para os anos de 2010 e 2021 MASCULINO

df_homens <- obts_causas_top_20 %>% filter(sexo=="M")

tbl_homens <- data.frame("significado"= df_homens$significado[1:20],
                           "2010" = df_homens$causas_count[1:20],
                           check.names = F) %>%
  left_join(.,df_homens[21:40,c("causas_count","significado")],
            by="significado")

names(tbl_homens)[3] <- "2021"

#causas de 2021 que nao estavam em 2010
tbl_homens <- rbind(tbl_homens, data.frame(significado=df_homens$significado[21],"2010"="-",
                                               "2021"=df_homens$causas_count[21],check.names = F))

tbl_homens <- rbind(tbl_homens, data.frame(significado=df_homens$significado[33:34],"2010"="-",
                                               "2021"=df_homens$causas_count[33:34],check.names = F))

tbl_homens <- rbind(tbl_homens, data.frame(significado=df_homens$significado[38:39],"2010"="-",
                                           "2021"=df_homens$causas_count[38:39],check.names = F))

tbl_homens$`2021`[is.na(tbl_homens$`2021`)] <- "-"
names(tbl_homens)[1] <- "Causa básica da DO"

tbl_homens %>% 
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
  kable(format="latex",caption = "Estrutura de mortalidade por causas de 2010 e 2021 para o sexo masculino.", booktabs = T, linesep="", digits=2,
        align=c('l','r','r'))  %>%
   kable_styling(latex_options=c("HOLD_position","scale_down"), position="center")
```

Nota-se que há muitas convergências, tanto de tendência quanto de ordem, como os apresentados por comparação das doenças do aparelho circulatório, doenças infecciosas e parasitárias, doenças do aparelho respiratório e casos de sintomas não classificados em outra parte. 
Em consonância, em 2020 os primeiros casos de COVID-19 começam a ser diagnosticados. Estima-se que o aumento no registro de causas de morte, cujos sintomas apresentam semelhantes à doença recém-descoberta, tenha ocorrido por falta de consenso do CID a ser utilizado e do claro diagnóstico da doença. Destaca-se que o Brasil foi um dos principais polos mundiais da doença, dado a grande população e fatores culturais, podendo ser também um contexto que favorece a ação de outras variáveis intervenientes quanto à quantidade de registros de causa mortis COVID-19, podendo inclusive, apresentar uma sub contagem dos casos da doença.
Nota-se que, em todas as causas de morte listadas ocorrerem em ambos os sexos, embora sempre é observado uma maior mortalidade na população masculina. 
causas, de maneira enviesada, visto que há CID com características semelhantes à COVID-19.

\newpage

**e) Construa Tábuas de Vida para cada sexo para a UF escolhida para 2021, a partir das taxas específicas de mortalidade obtidas no item a:**

```{r}
# Letra e -------

# Construa Tábuas de Vida para cada sexo para a UF escolhida para 2021, a partir das
# taxas específicas de mortalidade obtidas no item a:

# Utilize a TMI obtida no item b ou do estudo Global Burden of Disease - GBD.
# Lembre que deve-se obter a TMI para cada sexo em separado.

# Estime os fatores de separação, para cada sexo, para as idades 0-1 e 1-4 com base nos microdados do SIM.

l0 <- 100000

# Tábua sexo FEMININO
# calculando a TMI feminina

nasc_2021_feminino <- 46911 #dados do SINASC
nasc_2021_masculino <- 49577
# nº medio de obitos de menores de 1 ano
obitos_1_ano_mulher <- mortalidade %>% filter(ano_obt %in% c("2021")) %>%
  filter(sexo=="F") %>%
  filter(idade_dias<365) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_1_ano_F <- mean(obitos_1_ano_mulher$obitos)

q10F <- media_obt_1_ano_F/nasc_2021_feminino*1000

# Estimando os fatores de separacao

calcula_fator_separacao <- function(x,n,dados){
  obitos_periodo <- dados %>% filter(idade>=x & idade<=(x+n))
  tempo_vida_no_intervalo <- (obitos_periodo$idade - x)
  nkx <- mean(tempo_vida_no_intervalo)
  
  return(nkx)
}


mort_feminino <- mortalidade %>% filter(sexo=="F")
x <- c(0,1,seq(5,90,5)) 
n <- c(1,4,rep(5,17),35) # o ultimo n=35 é para aceitar idades até 90+35=125

ks_femininos <- purrr::map2(x,n, ~ calcula_fator_separacao(.x,.y,mort_feminino)) %>%
  unlist()

nMx_feminino <- nMx %>% filter(Ano==2021 & sexo=="Feminino")
nMx_feminino <- nMx_feminino$nMx

nqxF <- n*nMx_feminino/(1+(n-ks_femininos)*nMx_feminino)
nqxF[1] <- q10F/1000
nqxF[20] <- 1

lx <- c(l0)
ndx <- lx * nqxF[1]

for (i in 2:20){
  lx[i] <- lx[i-1]-ndx[i-1]
  ndx[i] <- lx[i] * nqxF[i]
}

nLxF <- lx*n + ndx*ks_femininos
nLxF_2021 <- nLxF[5:11]/100000
nLxF[20] <- ndx[20]*ks_femininos[20] 
TxF <- rev(cumsum(rev(nLxF)))

tabua_feminino <- data.frame("x"=x,"n"=c(n[-20],"+"),
                             "nMx"=round(nMx_feminino,4),
                             "nkx"=round(ks_femininos,3),
                             "nqx"=round(nqxF,4),
                             "lx"=lx,
                             "ndx"=round(ndx,3),
                             "nLx"=nLxF,
                             "Tx"=TxF,
                             "ex"=round(TxF/lx,3),
                             check.names = F)

tabua_feminino %>%
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
  kable(format="latex",caption = "Tábua de vida para o sexo feminino em 2021 - Santa Catarina.", booktabs = T, linesep="", digits=4,
        align=rep('r',10))  %>%
   kable_styling(latex_options=c("HOLD_position","scale_down"), position="center")

```

```{r}
# Tábua sexo MASCULINO
# calculando a TMI masculina

# nº medio de obitos de menores de 1 ano
obitos_1_ano_homem <- mortalidade %>% filter(ano_obt %in% c("2021")) %>%
  filter(sexo=="M") %>%
  filter(idade_dias<365) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_1_ano_M <- mean(obitos_1_ano_homem$obitos)

q10M <- media_obt_1_ano_M/nasc_2021_masculino*1000

# Estimando os fatores de separacao
mort_masc <- mortalidade %>% filter(sexo=="M")
x <- c(0,1,seq(5,90,5)) 
n <- c(1,4,rep(5,17),35) # o ultimo n=35 é para aceitar idades até 90+35=125

ks_masc <- purrr::map2(x,n, ~ calcula_fator_separacao(.x,.y,mort_masc)) %>%
  unlist()

nMx_masc <- nMx %>% filter(Ano==2021 & sexo=="Masculino")
nMx_masc <- nMx_masc$nMx

nqxM <- n*nMx_masc/(1+(n-ks_masc)*nMx_masc)
nqxM[1] <- q10M/1000
nqxM[20] <- 1

lx_masc <- c(l0)
ndx_masc <- lx_masc * nqxM[1]

for (i in 2:20){
  lx_masc[i] <- lx_masc[i-1]-ndx_masc[i-1]
  ndx_masc[i] <- lx_masc[i] * nqxM[i]
}

nLxM <- lx_masc*n + ndx_masc*ks_masc
nLxM[20] <- ndx_masc[20]*ks_masc[20] 
TxM <- rev(cumsum(rev(nLxM)))

tabua_masculino <- data.frame("x"=x,"n"=c(n[-20],"+"),
                             "nMx"=round(nMx_masc,4),
                             "nkx"=round(ks_masc,3),
                             "nqx"=round(nqxM,4),
                             "lx"=lx_masc,
                             "ndx"=round(ndx_masc,3),
                             "nLx"=nLxM,
                             "Tx"=TxM,
                             "ex"=round(TxM/lx_masc,3),
                             check.names = F)

tabua_masculino %>%
  mutate_if(is.numeric, ~comma(., decimal.mark = ",", big.mark = ".")) %>%
  kable(format="latex",caption = "Tábua de vida para o sexo masculino em 2021 - Santa Catarina.", booktabs = T, linesep="", digits=4,
        align=rep('r',10))  %>%
   kable_styling(latex_options=c("HOLD_position","scale_down"), position="center")

```


```{r}
nasc_2021_feminino <- 46911 #dados do SINASC
nasc_2019_feminino <- 47634
nasc_2010_feminino <- 41263


## Tabua 2019 ----
l0 <- 100000

# Tábua sexo FEMININO
# calculando a TMI feminina

nasc_feminino <- 47634 #dados do SINASC


# nº medio de obitos de menores de 1 ano
obitos_1_ano_mulher <- mortalidade %>% filter(ano_obt %in% c("2021")) %>%
  filter(sexo=="F") %>%
  filter(idade_dias<365) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_1_ano_F <- mean(obitos_1_ano_mulher$obitos)

q10F <- media_obt_1_ano_F/nasc_feminino*1000

# Estimando os fatores de separacao

calcula_fator_separacao <- function(x,n,dados){
  obitos_periodo <- dados %>% filter(idade>=x & idade<=(x+n))
  tempo_vida_no_intervalo <- (obitos_periodo$idade - x)
  nkx <- mean(tempo_vida_no_intervalo)
  
  return(nkx)
}


mort_feminino <- mortalidade %>% filter(sexo=="F")
x <- c(0,1,seq(5,90,5)) 
n <- c(1,4,rep(5,17),35) # o ultimo n=35 é para aceitar idades até 90+35=125

ks_femininos <- purrr::map2(x,n, ~ calcula_fator_separacao(.x,.y,mort_feminino)) %>%
  unlist()

nMx_feminino <- nMx %>% filter(Ano==2021 & sexo=="Feminino")
nMx_feminino <- nMx_feminino$nMx

nqxF <- n*nMx_feminino/(1+(n-ks_femininos)*nMx_feminino)
nqxF[1] <- q10F/1000
nqxF[20] <- 1

lx <- c(l0)
ndx <- lx * nqxF[1]

for (i in 2:20){
  lx[i] <- lx[i-1]-ndx[i-1]
  ndx[i] <- lx[i] * nqxF[i]
}

nLxF <- lx*n + ndx*ks_femininos
nLxF_2019 <- nLxF[5:11]/100000


## tabua 2010

l0 <- 100000

# Tábua sexo FEMININO
# calculando a TMI feminina

nasc_feminino <- 41263 #dados do SINASC


# nº medio de obitos de menores de 1 ano
obitos_1_ano_mulher <- mortalidade %>% filter(ano_obt %in% c("2021")) %>%
  filter(sexo=="F") %>%
  filter(idade_dias<365) %>% group_by(ano_obt) %>%
  summarise(obitos=n())

media_obt_1_ano_F <- mean(obitos_1_ano_mulher$obitos)

q10F <- media_obt_1_ano_F/nasc_feminino*1000

# Estimando os fatores de separacao

calcula_fator_separacao <- function(x,n,dados){
  obitos_periodo <- dados %>% filter(idade>=x & idade<=(x+n))
  tempo_vida_no_intervalo <- (obitos_periodo$idade - x)
  nkx <- mean(tempo_vida_no_intervalo)
  
  return(nkx)
}


mort_feminino <- mortalidade %>% filter(sexo=="F")
x <- c(0,1,seq(5,90,5)) 
n <- c(1,4,rep(5,17),35) # o ultimo n=35 é para aceitar idades até 90+35=125

ks_femininos <- purrr::map2(x,n, ~ calcula_fator_separacao(.x,.y,mort_feminino)) %>%
  unlist()

nMx_feminino <- nMx %>% filter(Ano==2021 & sexo=="Feminino")
nMx_feminino <- nMx_feminino$nMx

nqxF <- n*nMx_feminino/(1+(n-ks_femininos)*nMx_feminino)
nqxF[1] <- q10F/1000
nqxF[20] <- 1

lx <- c(l0)
ndx <- lx * nqxF[1]

for (i in 2:20){
  lx[i] <- lx[i-1]-ndx[i-1]
  ndx[i] <- lx[i] * nqxF[i]
}

nLxF <- lx*n + ndx*ks_femininos
nLxF_2010 <- nLxF[5:11]/100000



```


**Com base na TV calculada, grafique as funções lx e nqx para cada sexo e comente os resultados. Se lo=1, qual o significado da função lx? Interprete, neste caso, l20 e l60.**

\begin{figure}[H]
	\centering
		\caption{Função de sobrevivência lx para ambos sexos em 2021, Santa Catarina.}
		\includegraphics[scale = 1]{img/graf_lx.png}
	\label{fig:lx}
\end{figure}


\begin{figure}[H]
	\centering
		\caption{Função nqx para ambos sexos em 2021, Santa Catarina.}
		\includegraphics[scale = 1]{img/graf_nqx.png}
	\label{fig:nqx}
\end{figure}
